<!DOCTYPE html>
<html lang="tr">
<head>
    <link rel="stylesheet" href="style.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Çocuklar İçin Yapay Zeka Macerası</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Exo+2:wght@400;600;700;800&family=Orbitron:wght@400;500;600;700&display=swap');
        <script src="script.js"></script>
        
        body {
            font-family: 'Exo 2', sans-serif;
            background-color: #0d1222; /* Slightly darker base for better contrast */
            background-image: 
                radial-gradient(circle at 25% 25%, rgba(56, 189, 248, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 75% 75%, rgba(168, 85, 247, 0.15) 0%, transparent 50%);
            min-height: 100vh;
            overflow-x: hidden;
            color: #e2e8f0; /* Default text color for better readability */
        }
        
        .tech-font {
            font-family: 'Orbitron', sans-serif;
        }
        
        .card {
            perspective: 1000px;
            height: 400px; /* Fixed height for consistency */
            cursor: pointer;
        }
        
        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.8s;
            transform-style: preserve-3d;
        }
        
        .card.flipped .card-inner {
            transform: rotateY(180deg);
        }
        
        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            border-radius: 1.5rem;
            box-shadow: 0 0 25px rgba(56, 189, 248, 0.4); /* Enhanced shadow */
            overflow: hidden;
            display: flex;
            flex-direction: column;
            border: 3px solid; /* Thicker border */
        }
        
        .card-front {
            background: linear-gradient(135deg, #1a243a, #0d1222); /* Darker gradient */
            border-image: linear-gradient(45deg, #38bdf8, #a855f7) 1; /* Gradient border */
            color: #e2e8f0; /* Lighter text for contrast */
        }
        
        .card-back {
            background: linear-gradient(135deg, #1a243a, #0d1222); /* Darker gradient */
            border-image: linear-gradient(45deg, #a855f7, #f472b6) 1; /* Different gradient border */
            color: #e2e8f0; /* Lighter text for contrast */
            transform: rotateY(180deg);
        }
        
        .progress-bar {
            height: 12px; /* Slightly thicker */
            border-radius: 6px;
            background: rgba(56, 189, 248, 0.25);
            overflow: hidden;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.3);
        }
        
        .progress {
            height: 100%;
            background: linear-gradient(90deg, #38bdf8, #a855f7);
            transition: width 0.5s ease;
            border-radius: 6px;
        }
        
        .btn-nav {
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            border: 1px solid transparent; /* Ensure border for hover effect */
        }
        
        .btn-nav:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.4);
            border-color: rgba(255,255,255,0.2);
        }
        
        .btn-nav:active {
            transform: translateY(0);
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        .character {
            position: absolute;
            bottom: -10px;
            right: -10px;
            width: 120px;
            height: 120px;
            transition: all 0.3s ease;
        }
        
        .card:hover .character {
            transform: translateY(-10px);
        }
        
        .stars {
            position: absolute;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: -1;
        }
        
        .star {
            position: absolute;
            background-color: white;
            border-radius: 50%;
            animation: twinkle 2s infinite;
        }
        
        @keyframes twinkle {
            0% { opacity: 0; }
            50% { opacity: 1; }
            100% { opacity: 0; }
        }
        
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            opacity: 0;
            background-color: var(--color);
            border-radius: 50%;
            animation: fall 3s ease-out forwards;
            z-index: 9999;
        }

        @keyframes fall {
            0% { transform: translateY(-100vh) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }
        
        .badge {
            position: absolute;
            top: 15px;
            right: 15px;
            background: linear-gradient(45deg, #38bdf8, #a855f7);
            color: white;
            border-radius: 20px;
            padding: 5px 12px;
            font-size: 12px;
            font-weight: bold;
            box-shadow: 0 3px 6px rgba(0,0,0,0.3);
            z-index: 10;
        }
        
        .glow {
            animation: glow 2s infinite alternate;
        }
        
        @keyframes glow {
            from {
                box-shadow: 0 0 10px rgba(56, 189, 248, 0.5);
            }
            to {
                box-shadow: 0 0 20px rgba(56, 189, 248, 0.8), 0 0 30px rgba(168, 85, 247, 0.5);
            }
        }
        
        .floating {
            animation: floating 3s infinite ease-in-out;
        }
        
        @keyframes floating {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .tech-bg {
            background-image: 
                linear-gradient(rgba(13, 18, 34, 0.95), rgba(13, 18, 34, 0.95)), /* Darker overlay */
                url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%2338bdf8' fill-opacity='0.1' fill-rule='evenodd'/%3E%3C/svg%3E");
        }
        
        .circuit-border {
            border-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%2338bdf8' fill-opacity='0.4' fill-rule='evenodd'/%3E%3C/svg%3E") 1;
            border-width: 4px;
            border-style: solid;
        }
        
        .certificate {
            background-image: 
                linear-gradient(rgba(13, 18, 34, 0.95), rgba(13, 18, 34, 0.95)), /* Darker overlay */
                url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='white' fill-opacity='0.05' fill-rule='evenodd'/%3E%3C/svg%3E");
            background-color: #0d1222;
            border: 4px solid;
            border-image: linear-gradient(45deg, #38bdf8, #a855f7, #f472b6, #38bdf8) 1;
            box-shadow: 0 0 30px rgba(56, 189, 248, 0.5), 0 0 50px rgba(168, 85, 247, 0.5);
            position: relative;
            overflow: hidden;
        }
        
        .certificate::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle at 50% 50%, rgba(56, 189, 248, 0.15) 0%, transparent 70%);
            animation: rotate-glow 15s linear infinite;
            z-index: -1;
        }

        @keyframes rotate-glow {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .typing-effect {
            overflow: hidden;
            border-right: .15em solid #38bdf8;
            white-space: nowrap;
            margin: 0 auto;
            letter-spacing: .15em;
            animation: 
                typing 3.5s steps(40, end),
                blink-caret .75s step-end infinite;
        }
        
        @keyframes typing {
            from { width: 0 }
            to { width: 100% }
        }
        
        @keyframes blink-caret {
            from, to { border-color: transparent }
            50% { border-color: #38bdf8; }
        }
        
        .sound-wave {
            display: flex;
            align-items: center;
            gap: 3px;
            height: 20px;
        }
        
        .sound-wave span {
            display: block;
            width: 3px;
            height: 100%;
            background: linear-gradient(to bottom, #38bdf8, #a855f7);
            border-radius: 3px;
            animation: sound-wave-animation 1.2s infinite ease-in-out;
        }
        
        .sound-wave span:nth-child(2) { animation-delay: 0.2s; }
        .sound-wave span:nth-child(3) { animation-delay: 0.4s; }
        .sound-wave span:nth-child(4) { animation-delay: 0.6s; }
        .sound-wave span:nth-child(5) { animation-delay: 0.8s; }
        
        @keyframes sound-wave-animation {
            0%, 100% { height: 5px; }
            50% { height: 20px; }
        }
        
        .robot-eye {
            animation: blink 4s infinite;
        }
        
        @keyframes blink {
            0%, 45%, 55%, 100% { height: 8px; }
            50% { height: 1px; }
        }

        /* Matching Game Specific Styles */
        .matching-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr); /* Adjusted for better mobile layout */
            gap: 1rem;
        }
        @media (min-width: 768px) {
            .matching-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        .matching-card {
            background-color: #1a243a; /* Darker background */
            border: 2px solid #38bdf8;
            border-radius: 0.75rem;
            height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem; /* Adjusted font size for smaller cards */
            font-weight: bold;
            color: #e2e8f0; /* Lighter text for contrast */
            cursor: pointer;
            transform-style: preserve-3d;
            transition: transform 0.6s;
            position: relative;
            box-shadow: 0 4px 15px rgba(0,0,0,0.4); /* Enhanced shadow */
            word-break: break-word; /* Allow text to break words */
            padding: 0.5rem; /* Added padding */
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5); /* Text shadow for readability */
        }

        /* This is the key fix: when .matching-card has 'flipped' class, rotate it */
        .matching-card.flipped {
            transform: rotateY(180deg);
        }

        .matching-card .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 0.75rem;
            padding: 0.5rem;
            text-align: center;
        }

        .matching-card .card-front-face {
            transform: rotateY(0deg); /* Explicitly set for front face */
            background: linear-gradient(135deg, #1a243a, #0d1222); /* Match card front */
        }

        .matching-card .card-back-face {
            background: linear-gradient(135deg, #38bdf8, #a855f7);
            transform: rotateY(180deg);
            color: white;
            font-size: 0.9rem; /* Slightly smaller font for descriptions */
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5); /* Text shadow for readability */
        }

        .matching-card.matched {
            pointer-events: none;
            background: linear-gradient(135deg, #10b981, #059669);
            border-color: #10b981;
            color: white;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.5);
        }

        /* Custom Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.85); /* Darker overlay */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }

        .modal-content {
            background-color: #1a243a; /* Darker background */
            padding: 2.5rem; /* More padding */
            border-radius: 1.5rem; /* More rounded */
            box-shadow: 0 0 30px rgba(56, 189, 248, 0.6); /* Enhanced shadow */
            text-align: center;
            color: #e2e8f0;
            max-width: 90%;
            width: 450px; /* Slightly wider */
            border: 2px solid #38bdf8;
            position: relative;
            overflow: hidden;
        }
        .modal-content::before {
            content: '';
            position: absolute;
            top: -20px;
            left: -20px;
            right: -20px;
            bottom: -20px;
            background: radial-gradient(circle at 50% 50%, rgba(56, 189, 248, 0.1) 0%, transparent 70%);
            animation: rotate-glow 10s linear infinite;
            z-index: -1;
        }

        .modal-buttons {
            display: flex;
            justify-content: center;
            gap: 1.5rem; /* More space between buttons */
            margin-top: 2rem;
        }

        /* Print specific styles */
        @media print {
            body > *:not(#certificate-screen) {
                display: none !important;
            }
            #certificate-screen {
                display: block !important;
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                margin: 0;
                padding: 0;
                box-shadow: none;
                background-image: none; /* Remove background patterns for print */
                background-color: white; /* White background for printing */
                color: black; /* Black text for printing */
            }
            #certificate-screen .certificate {
                border: none; /* Remove border for print */
                background-image: none;
                background-color: white;
                color: black;
                box-shadow: none;
                padding: 20px;
                height: 100%;
                display: flex;
                flex-direction: column;
                justify-content;
                align-items: center;
            }
            #certificate-screen .certificate h1, #certificate-screen .certificate p, #certificate-screen .certificate span {
                color: black !important;
                -webkit-print-color-adjust: exact; /* For printing background colors/gradients */
                print-color-adjust: exact;
            }
            #certificate-screen .flex.justify-between.items-center.mb-6 {
                display: none; /* Hide buttons in print view */
            }
        }

        /* 3D Robot Canvas Styling */
        #robot-canvas {
            width: 100%;
            height: 100%;
            display: block;
            border-radius: 1rem; /* Rounded corners for the canvas */
            box-shadow: 0 0 20px rgba(56, 189, 248, 0.5); /* Subtle glow */
        }
    </style>
</head>
<body class="p-4 md:p-8">
    <div class="stars" id="stars"></div>
    
    <div class="absolute top-4 right-4 z-50">
        <button id="lang-toggle-tr" class="bg-gray-700 text-white px-3 py-1 rounded-l-lg text-sm font-bold hover:bg-gray-600" data-lang="tr">TR</button>
        <button id="lang-toggle-en" class="bg-gray-800 text-white px-3 py-1 rounded-r-lg text-sm font-bold hover:bg-gray-600" data-lang="en">EN</button>
    </div>

    <div id="welcome-screen" class="max-w-5xl mx-auto">
        <div class="bg-slate-800 bg-opacity-90 rounded-3xl p-6 md:p-8 shadow-xl tech-bg glow">
            <div class="flex flex-col items-center justify-center py-8">
                <div class="mb-6 relative">
                    <div class="absolute inset-0 bg-gradient-to-r from-cyan-500 to-purple-500 blur-xl opacity-20 rounded-full"></div>
                    <h1 class="tech-font text-4xl md:text-6xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-purple-400 relative z-10 text-center" data-lang-key="welcome_title">
                        YAPAY ZEKA MACERASI
                    </h1>
                </div>
                
                <div id="initial-intro-screen" class="w-full max-w-md mx-auto mb-8 relative text-center">
                    <p class="text-cyan-300 text-center mb-6 text-lg" data-lang-key="intro_message">
                        Çocuklar, ebeveynlerinizle birlikte misiniz? Eğer size eşlik edecek bir yetişkin varsa, haydi başlayalım!
                    </p>
                    <button 
                        id="continue-intro-btn" 
                        class="bg-gradient-to-r from-cyan-500 to-purple-500 text-white rounded-lg px-8 py-3 font-medium shadow-sm hover:from-cyan-600 hover:to-purple-600 transition-all tech-font flex items-center justify-center mx-auto"
                        data-lang-key="continue_button"
                    >
                        DEVAM ET
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline ml-2" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4-4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" />
                        </svg>
                    </button>
                </div>

                <div id="name-input-section" class="w-full max-w-md mx-auto mb-8 relative hidden">
                    <div class="floating mb-8 w-40 h-40 mx-auto">
                        <canvas id="robot-canvas"></canvas>
                    </div>
                    
                    <p class="text-cyan-300 text-center mb-6" data-lang-key="welcome_intro">
                        Merhaba genç kaşif! Yapay zeka dünyasına heyecan verici bir yolculuğa çıkmaya hazır mısın?
                    </p>
                    
                    <div class="bg-slate-900 p-6 rounded-xl border border-cyan-500 shadow-lg">
                        <label for="user-name" class="block text-cyan-300 mb-2 tech-font" data-lang-key="enter_name">
                            İSMİNİ GİR:
                        </label>
                        <div class="flex flex-col sm:flex-row">
                            <input 
                                type="text" 
                                id="user-name" 
                                class="bg-slate-800 text-cyan-300 border border-cyan-500 rounded-lg sm:rounded-l-lg sm:rounded-r-none p-3 w-full focus:outline-none focus:ring-2 focus:ring-cyan-500 tech-font mb-2 sm:mb-0"
                                placeholder="Adın ve Soyadın"
                                data-lang-placeholder-key="name_placeholder"
                            >
                            <button 
                                id="start-adventure" 
                                class="bg-gradient-to-r from-cyan-500 to-purple-500 text-white rounded-lg sm:rounded-r-lg sm:rounded-l-none px-4 py-3 sm:py-0 hover:from-cyan-600 hover:to-purple-600 transition-all tech-font flex items-center justify-center"
                                data-lang-key="start_button"
                            >
                                BAŞLA
                                <div class="sound-wave ml-2">
                                    <span></span>
                                    <span></span>
                                    <span></span>
                                    <span></span>
                                    <span></span>
                                </div>
                            </button>
                        </div>
                        <p class="text-xs text-cyan-400 mt-2" data-lang-key="name_hint">* İsmin sertifikanda görünecek</p>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 w-full">
                    <div class="bg-slate-900 p-4 rounded-xl border border-cyan-800">
                        <div class="flex items-center mb-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-cyan-400 mr-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20V6.5A2.5 2.5 0 0 0 17.5 4h-11A2.5 2.5 0 0 0 4 6.5v13z"></path>
                                <path d="M14 5l-4 4"></path>
                                <path d="M10 5l4 4"></path>
                            </svg>
                            <h3 class="text-cyan-400 font-bold tech-font" data-lang-key="learn_title">ÖĞREN</h3>
                        </div>
                        <p class="text-cyan-200 text-sm" data-lang-key="learn_text">Yapay zeka hakkında eğlenceli hikayeler ve açıklamalarla yeni bilgiler öğren.</p>
                    </div>
                    
                    <div class="bg-slate-900 p-4 rounded-xl border border-purple-800">
                        <div class="flex items-center mb-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-purple-400 mr-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"></circle>
                                <path d="M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20"></path>
                                <path d="M2 12h20"></path>
                            </svg>
                            <h3 class="text-purple-400 font-bold tech-font" data-lang-key="explore_title">KEŞFET</h3>
                        </div>
                        <p class="text-purple-200 text-sm" data-lang-key="explore_text">Robotlar ve yapay zeka dünyasını interaktif kartlarla keşfet.</p>
                    </div>
                    
                    <div class="bg-slate-900 p-4 rounded-xl border border-pink-800">
                        <div class="flex items-center mb-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-pink-400 mr-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M14.5 8a2.5 2.5 0 0 0-5 0v3.5a2.5 2.5 0 0 1-5 0V8a2.5 2.5 0 0 0-5 0"></path>
                                <path d="M2 12h20"></path>
                                <path d="M12 2v20"></path>
                                <path d="M12 12h.01"></path>
                            </svg>
                            <h3 class="text-pink-400 font-bold tech-font" data-lang-key="certificate_title">SERTİFİKA</h3>
                        </div>
                        <p class="text-pink-200 text-sm" data-lang-key="certificate_text">Tüm kartları tamamla ve kendi özel yapay zeka sertifikanı kazan!</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div id="game-screen" class="max-w-5xl mx-auto hidden">
        <div class="bg-slate-800 bg-opacity-90 rounded-3xl p-6 md:p-8 shadow-xl tech-bg">
            <div class="flex flex-col md:flex-row justify-between items-center mb-8">
                <button id="btn-main-menu-game" class="btn-nav bg-slate-900 text-cyan-400 border border-cyan-700 rounded-lg px-4 py-2 font-medium shadow-sm hover:bg-slate-800 tech-font mb-4 md:mb-0">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline mr-1" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd" />
                    </svg>
                    <span data-lang-key="main_menu_button">ANA MENÜ</span>
                </button>
                <div>
                    <h1 class="tech-font text-3xl md:text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-purple-400" data-lang-key="welcome_title">
                        YAPAY ZEKA MACERASI
                    </h1>
                    <p class="text-cyan-300"><span data-lang-key="hello_explorer">Merhaba</span> <span id="user-name-display" class="font-bold text-white"></span><span data-lang-key="ready_to_explore">! Yapay zeka dünyasını keşfetmeye hazır mısın?</span></p>
                </div>
                <div class="mt-4 md:mt-0 flex items-center">
                    <span class="bg-gradient-to-r from-cyan-900 to-purple-900 text-white py-2 px-4 rounded-full text-sm font-bold tech-font" data-lang-key="progress">
                        İLERLEME: <span id="overall-progress-count">0</span>/<span id="overall-total-count">0</span>
                    </span>
                    <div class="ml-3 bg-yellow-900 text-yellow-300 py-1 px-3 rounded-full text-xs font-bold flex items-center tech-font">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                        </svg>
                        <span data-lang-key="child_friendly">ÇOCUK DOSTU</span>
                    </div>
                </div>
            </div>
            
            <div class="mb-6">
                <div class="flex justify-between items-center mb-2">
                    <span class="text-sm text-cyan-300 tech-font" data-lang-key="progress_bar_label">İLERLEME ÇUBUĞU</span>
                    <span class="text-sm font-medium text-cyan-300 tech-font"><span id="progress-percent">0</span>%</span>
                </div>
                <div class="progress-bar">
                    <div class="progress" id="progress-bar" style="width: 0%"></div>
                </div>
            </div>
            
            <div class="grid grid-cols-1 gap-8">
                <div class="card" id="current-card">
                    <div class="card-inner">
                        <div class="card-front">
                            <div class="badge" id="card-badge"><span data-lang-key="concept">KAVRAM</span> #1</div>
                            <div class="p-6 flex flex-col h-full">
                                <h2 class="text-2xl font-bold mb-2 tech-font text-cyan-300" id="card-front-title"></h2>
                                <div class="flex-grow overflow-auto pr-2">
                                    <div id="card-front-svg" class="w-full h-48 flex items-center justify-center mb-4 floating">
                                        </div>
                                    <p id="card-front-text" class="text-cyan-100">
                                        </p>
                                </div>
                                <p class="mt-4 text-center text-cyan-400 text-sm tech-font pulse" data-lang-key="flip_card_hint">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block mr-1" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M15.707 4.293a1 1 0 010 1.414l-5 5a1 1 0 01-1.414 0l-5-5a1 1 0 011.414-1.414L10 8.586l4.293-4.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                                    </svg>
                                    HİKAYEYİ OKUMAK İÇİN KARTI ÇEVİR
                                </p>
                            </div>
                        </div>
                        <div class="card-back">
                            <div class="p-6 flex flex-col h-full">
                                <h2 class="text-2xl font-bold mb-2 tech-font text-purple-300" id="card-back-title"></h2>
                                <div class="flex-grow overflow-auto pr-2">
                                    <p id="card-back-text" class="text-purple-100">
                                        </p>
                                </div>
                                <div class="mt-4 text-center">
                                    <button id="btn-listen-story" class="btn-nav bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-lg px-5 py-2 font-medium shadow-sm hover:from-blue-700 hover:to-indigo-700 tech-font">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline mr-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <path d="M11 5L6 9H2v6h4l5 4V5z"></path>
                                            <path d="M19.07 4.93a10 10 0 0 1 0 14.14M22.49 2.49a15 15 0 0 1 0 21.02"></path>
                                        </svg>
                                        <span data-lang-key="listen_story_button">DİNLE</span>
                                    </button>
                                    <button id="btn-toggle-story" class="btn-nav bg-gradient-to-r from-pink-600 to-red-600 text-white rounded-lg px-5 py-2 font-medium shadow-sm hover:from-pink-700 hover:to-red-700 tech-font ml-2">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline mr-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <path d="M12 3a6 6 0 0 0 9 7.5V13a2 2 0 0 1-2 2h-2.5A2.5 2.5 0 0 1 12 17.5V21M12 3a6 6 0 0 1-9 7.5V13a2 2 0 0 0 2 2h2.5A2.5 2.5 0 0 0 12 17.5V21"></path>
                                            <path d="M12 21v-3.5"></path>
                                            <path d="M12 3v3.5"></path>
                                        </svg>
                                        <span id="toggle-story-button-text" data-lang-key="toggle_story_button">AI ile Oluştur</span>
                                    </button>
                                </div>
                                <div class="mt-4 text-center">
                                    <span class="inline-block bg-cyan-900 text-cyan-300 rounded-full px-3 py-1 text-sm font-semibold mr-2 mb-2 tech-font">#YapayZeka</span>
                                    <span class="inline-block bg-purple-900 text-purple-300 rounded-full px-3 py-1 text-sm font-semibold mr-2 mb-2 tech-font">#Robotlar</span>
                                    <span class="inline-block bg-pink-900 text-pink-300 rounded-full px-3 py-1 text-sm font-semibold mb-2 tech-font">#Öğrenme</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="flex flex-col sm:flex-row justify-between mt-6 space-y-4 sm:space-y-0">
                    <button id="btn-prev" class="btn-nav bg-slate-900 text-cyan-400 border border-cyan-700 rounded-lg px-5 py-2 font-medium shadow-sm hover:bg-slate-800 disabled:opacity-50 disabled:cursor-not-allowed tech-font">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline mr-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M15 18l-6-6 6-6"></path>
                        </svg>
                        <span data-lang-key="prev_button">ÖNCEKİ</span>
                    </button>
                    
                    <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2">
                        <button id="btn-known" class="btn-nav bg-gradient-to-r from-green-600 to-emerald-600 text-white rounded-lg px-5 py-2 font-medium shadow-sm hover:from-green-700 hover:to-emerald-700 tech-font">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline mr-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M20 6L9 17l-5-5"></path>
                            </svg>
                            <span data-lang-key="understood_button">ANLADIM</span>
                        </button>
                        <button id="btn-unknown" class="btn-nav bg-gradient-to-r from-orange-600 to-red-600 text-white rounded-lg px-5 py-2 font-medium shadow-sm hover:from-orange-700 hover:to-red-700 tech-font">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline mr-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M10 10l4 4m0-4l-4 4"></path>
                                <circle cx="12" cy="12" r="10"></circle>
                            </svg>
                            <span data-lang-key="repeat_button">TEKRAR</span>
                        </button>
                    </div>
                    
                    <button id="btn-next" class="btn-nav bg-gradient-to-r from-cyan-600 to-purple-600 text-white rounded-lg px-5 py-2 font-medium shadow-sm hover:from-cyan-700 hover:to-purple-700 disabled:opacity-50 disabled:cursor-not-allowed tech-font">
                        <span data-lang-key="next_button">SONRAKİ</span>
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline ml-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M9 18l6-6-6-6"></path>
                        </svg>
                    </button>
                </div>
            </div>
            
            <div class="mt-8 pt-6 border-t border-slate-700">
                <div class="flex justify-between items-center">
                    <h2 class="text-xl font-semibold text-cyan-300 tech-font" data-lang-key="learning_stats">ÖĞRENME İSTATİSTİKLERİ</h2>
                    <button id="btn-reset" class="text-sm text-cyan-500 hover:text-cyan-300 flex items-center tech-font">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21.5 2v6h-6M2.5 22v-6h6"></path>
                            <path d="M2.5 16a9 9 0 0 1 18.5-4 9 9 0 0 1-2.5 8"></path>
                        </svg>
                        <span data-lang-key="reset_button">SIFIRLA</span>
                    </button>
                </div>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-4">
                    <div class="bg-slate-900 p-4 rounded-xl border border-cyan-800">
                        <p class="text-sm text-cyan-400 tech-font" data-lang-key="total_cards">TOPLAM KART</p>
                        <p class="text-2xl font-bold text-cyan-300 tech-font">5</p>
                    </div>
                    <div class="bg-slate-900 p-4 rounded-xl border border-green-800">
                        <p class="text-sm text-green-400 tech-font" data-lang-key="understood">ANLAŞILAN</p>
                        <p class="text-2xl font-bold text-green-300 tech-font" id="stats-known">0</p>
                    </div>
                    <div class="bg-slate-900 p-4 rounded-xl border border-orange-800">
                        <p class="text-sm text-orange-400 tech-font" data-lang-key="to_repeat">TEKRAR EDİLECEK</p>
                        <p class="text-2xl font-bold text-orange-300 tech-font" id="stats-unknown">0</p>
                    </div>
                    <div class="bg-slate-900 p-4 rounded-xl border border-blue-800">
                        <p class="text-sm text-blue-400 tech-font" data-lang-key="remaining">KALAN</p>
                        <p class="text-2xl font-bold text-blue-300 tech-font" id="stats-remaining">5</p>
                    </div>
                </div>
            </div>

            <div class="mt-8 pt-6 border-t border-slate-700">
                <h2 class="text-xl font-semibold text-cyan-300 tech-font mb-4" data-lang-key="ask_ronin_title">✨ Ronin'e Soru Sor</h2>
                <div class="bg-slate-900 p-6 rounded-xl border border-cyan-500 shadow-lg">
                    <label for="ronin-question-input" class="block text-cyan-300 mb-2 tech-font" data-lang-key="ask_ronin_prompt">
                        Yapay zeka hakkında bir soru sor:
                    </label>
                    <div class="flex flex-col sm:flex-row">
                        <input 
                            type="text" 
                            id="ronin-question-input" 
                            class="bg-slate-800 text-cyan-300 border border-cyan-500 rounded-lg sm:rounded-l-lg sm:rounded-r-none p-3 w-full focus:outline-none focus:ring-2 focus:ring-cyan-500 tech-font mb-2 sm:mb-0"
                            placeholder="Örn: Robotlar rüya görür mü?"
                            data-lang-placeholder-key="ask_ronin_placeholder"
                        >
                        <button 
                            id="ask-ronin-btn" 
                            class="bg-gradient-to-r from-cyan-500 to-purple-500 text-white rounded-lg sm:rounded-r-lg sm:rounded-l-none px-4 py-3 sm:py-0 hover:from-cyan-600 hover:to-purple-600 transition-all tech-font flex items-center justify-center"
                            data-lang-key="ask_ronin_button"
                        >
                            SOR ✨
                        </button>
                    </div>
                    <div id="ronin-answer-container" class="mt-4 p-4 bg-slate-800 rounded-lg border border-purple-500 text-purple-200 min-h-[80px] flex items-center justify-center text-center">
                        <p id="ronin-answer" data-lang-key="ronin_answer_placeholder">Ronin'in cevabını bekliyorum...</p>
                        <div id="ronin-loading-indicator" class="hidden sound-wave ml-4">
                            <span></span><span></span><span></span><span></span><span></span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="mt-8 pt-6 border-t border-slate-700">
                <h2 class="text-xl font-semibold text-cyan-300 tech-font mb-4" data-lang-key="ai_story_generator_title">✨ Yapay Zeka Hikaye Oluşturucu</h2>
                <div class="bg-slate-900 p-6 rounded-xl border border-purple-500 shadow-lg">
                    <label for="story-keywords-input" class="block text-cyan-300 mb-2 tech-font" data-lang-key="story_keywords_prompt">
                        Hikayende hangi anahtar kelimeler olsun? (virgülle ayır)
                    </label>
                    <input 
                        type="text" 
                        id="story-keywords-input" 
                        class="bg-slate-800 text-cyan-300 border border-purple-500 rounded-lg p-3 w-full mb-4 focus:outline-none focus:ring-2 focus:ring-purple-500 tech-font"
                        placeholder="Örn: robot, uzay, arkadaşlık"
                        data-lang-placeholder-key="story_keywords_placeholder"
                    >
                    <button 
                        id="generate-story-btn" 
                        class="bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-lg px-6 py-3 w-full font-medium shadow-sm hover:from-purple-600 hover:to-pink-600 transition-all tech-font"
                        data-lang-key="generate_story_button"
                    >
                        HİKAYE OLUŞTUR ✨
                    </button>
                    <div id="ai-story-output" class="mt-4 p-4 bg-slate-800 rounded-lg border border-pink-500 text-pink-200 min-h-[120px] overflow-auto">
                        <p id="story-text" data-lang-key="story_placeholder">Hikayen burada belirecek...</p>
                        <div id="story-loading-indicator" class="hidden sound-wave ml-4 justify-center mt-4">
                            <span></span><span></span><span></span><span></span><span></span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="mt-8 pt-6 border-t border-slate-700">
                <h2 class="text-xl font-semibold text-cyan-300 tech-font mb-4" data-lang-key="ai_scenario_title">✨ Yapay Zeka Ne Yapar?</h2>
                <div class="bg-slate-900 p-6 rounded-xl border border-green-500 shadow-lg">
                    <label for="scenario-input" class="block text-cyan-300 mb-2 tech-font" data-lang-key="scenario_prompt">
                        Bir senaryo yaz:
                    </label>
                    <input 
                        type="text" 
                        id="scenario-input" 
                        class="bg-slate-800 text-cyan-300 border border-green-500 rounded-lg p-3 w-full mb-4 focus:outline-none focus:ring-2 focus:ring-green-500 tech-font"
                        placeholder="Örn: Bir robot hastanede"
                        data-lang-placeholder-key="scenario_placeholder"
                    >
                    <button 
                        id="analyze-scenario-btn" 
                        class="bg-gradient-to-r from-green-500 to-emerald-500 text-white rounded-lg px-6 py-3 w-full font-medium shadow-sm hover:from-green-600 hover:to-emerald-600 transition-all tech-font"
                        data-lang-key="analyze_scenario_button"
                    >
                        ANALİZ ET ✨
                    </button>
                    <div id="ai-scenario-output" class="mt-4 p-4 bg-slate-800 rounded-lg border border-emerald-500 text-emerald-200 min-h-[120px] overflow-auto">
                        <p id="scenario-analysis-text" data-lang-key="scenario_analysis_placeholder">Yapay zeka bu senaryoda ne yapabilir?</p>
                        <div id="scenario-loading-indicator" class="hidden sound-wave ml-4 justify-center mt-4">
                            <span></span><span></span><span></span><span></span><span></span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="mt-8 pt-6 border-t border-slate-700">
                <h2 class="text-xl font-semibold text-cyan-300 tech-font mb-4" data-lang-key="ai_fun_fact_title">✨ Yapay Zeka Eğlenceli Bilgi</h2>
                <div class="bg-slate-900 p-6 rounded-xl border border-orange-500 shadow-lg">
                    <button 
                        id="generate-fun-fact-btn" 
                        class="bg-gradient-to-r from-orange-500 to-yellow-500 text-white rounded-lg px-6 py-3 w-full font-medium shadow-sm hover:from-orange-600 hover:to-yellow-600 transition-all tech-font"
                        data-lang-key="generate_fun_fact_button"
                    >
                        EĞLENCELİ BİLGİ OLUŞTUR ✨
                    </button>
                    <div id="ai-fun-fact-output" class="mt-4 p-4 bg-slate-800 rounded-lg border border-yellow-500 text-yellow-200 min-h-[80px] flex items-center justify-center text-center">
                        <p id="fun-fact-text" data-lang-key="fun_fact_placeholder">Yapay zeka hakkında eğlenceli bir bilgi burada belirecek...</p>
                        <div id="fun-fact-loading-indicator" class="hidden sound-wave ml-4">
                            <span></span><span></span><span></span><span></span><span></span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="mt-8 pt-6 border-t border-slate-700">
                <h2 class="text-xl font-semibold text-cyan-300 tech-font mb-4" data-lang-key="ai_invention_title">✨ Yapay Zeka İcat Fikri</h2>
                <div class="bg-slate-900 p-6 rounded-xl border border-red-500 shadow-lg">
                    <label for="invention-topic-input" class="block text-cyan-300 mb-2 tech-font" data-lang-key="invention_topic_prompt">
                        Hangi konuda icat fikri istersin?
                    </label>
                    <input 
                        type="text" 
                        id="invention-topic-input" 
                        class="bg-slate-800 text-cyan-300 border border-red-500 rounded-lg p-3 w-full mb-4 focus:outline-none focus:ring-2 focus:ring-red-500 tech-font"
                        placeholder="Örn: evcil hayvanlar, çevre, oyunlar"
                        data-lang-placeholder-key="invention_topic_placeholder"
                    >
                    <button 
                        id="generate-invention-btn" 
                        class="bg-gradient-to-r from-red-500 to-pink-500 text-white rounded-lg px-6 py-3 w-full font-medium shadow-sm hover:from-red-600 hover:to-pink-600 transition-all tech-font"
                        data-lang-key="generate_invention_button"
                    >
                        İCAT FİKRİ OLUŞTUR ✨
                    </button>
                    <div id="ai-invention-output" class="mt-4 p-4 bg-slate-800 rounded-lg border border-pink-500 text-pink-200 min-h-[120px] overflow-auto">
                        <p id="invention-text" data-lang-key="invention_placeholder">Yapay zeka icat fikrin burada belirecek...</p>
                        <div id="invention-loading-indicator" class="hidden sound-wave ml-4 justify-center mt-4">
                            <span></span><span></span><span></span><span></span><span></span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="mt-8 pt-6 border-t border-slate-700">
                <h2 class="text-xl font-semibold text-cyan-300 tech-font mb-4" data-lang-key="ai_game_idea_title">✨ Yapay Zeka Oyun Fikri</h2>
                <div class="bg-slate-900 p-6 rounded-xl border border-blue-500 shadow-lg">
                    <label for="game-theme-input" class="block text-cyan-300 mb-2 tech-font" data-lang-key="game_theme_prompt">
                        Hangi konuda oyun fikri istersin?
                    </label>
                    <input 
                        type="text" 
                        id="game-theme-input" 
                        class="bg-slate-800 text-cyan-300 border border-blue-500 rounded-lg p-3 w-full mb-4 focus:outline-none focus:ring-2 focus:ring-blue-500 tech-font"
                        placeholder="Örn: uzay, hayvanlar, macera"
                        data-lang-placeholder-key="game_theme_placeholder"
                    >
                    <button 
                        id="generate-game-idea-btn" 
                        class="bg-gradient-to-r from-blue-500 to-indigo-500 text-white rounded-lg px-6 py-3 w-full font-medium shadow-sm hover:from-blue-600 hover:to-indigo-600 transition-all tech-font"
                        data-lang-key="generate_game_idea_button"
                    >
                        OYUN FİKRİ OLUŞTUR ✨
                    </button>
                    <div id="ai-game-idea-output" class="mt-4 p-4 bg-slate-800 rounded-lg border border-indigo-500 text-indigo-200 min-h-[120px] overflow-auto">
                        <p id="game-idea-text" data-lang-key="game_idea_placeholder">Oyun fikrin burada belirecek...</p>
                        <div id="game-idea-loading-indicator" class="hidden sound-wave ml-4 justify-center mt-4">
                            <span></span><span></span><span></span><span></span><span></span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="certificate-button-container" class="mt-8 pt-6 border-t border-slate-700 text-center hidden">
                <button id="btn-get-certificate" class="bg-gradient-to-r from-yellow-500 to-orange-500 text-white rounded-lg px-8 py-4 font-bold text-lg shadow-lg hover:from-yellow-600 hover:to-orange-600 transition-all tech-font pulse">
                    <span class="relative inline-block" data-lang-key="get_certificate_button">
                        SERTİFİKANI AL!
                        <span class="absolute top-0 right-0 -mt-2 -mr-2 bg-purple-400 text-xs rounded-full h-6 w-6 flex items-center justify-center">
                            🌟
                        </span>
                    </span>
                </button>
            </div>

        </div>
        <footer class="mt-12 p-6 bg-slate-900 bg-opacity-90 rounded-3xl text-slate-400 text-center text-sm tech-font shadow-xl border border-slate-700">
            <h3 class="text-lg font-bold text-cyan-300 mb-2" data-lang-key="about_title">Hakkında</h3>
            <p class="mb-4" data-lang-key="about_text">
                Bu sayfada yer alan bilgiler, kaynak gösterilen içeriklerden derlenmiştir. Sertifikanın yasal bir geçerliliği yoktur, sadece eğitim amacıyla ve kar gütmeden hazırlanmıştır.
            </p>
            <h3 class="text-lg font-bold text-cyan-300 mb-2" data-lang-key="contact_title">İletişim</h3>
            <p class="mb-2">
                <span data-lang-key="contact_message">Sorularınız veya geri bildirimleriniz için LinkedIn üzerinden iletişime geçebilirsiniz:</span>
            </p>
            <p class="mb-4">
                <a href="https://www.linkedin.com/in/semayy" target="_blank" class="text-blue-400 hover:underline">linkedin.com/in/semayy</a>
            </p>
            <p class="font-bold text-cyan-300">Semanur Ayyıldız</p>
            <p class="text-xs text-slate-500">Görsel İletişim Tasarımı ve Dijital Dönüşüm Uzmanı</p>
            <p class="mt-4 text-xs text-slate-500">© 2025 <span data-lang-key="all_rights_reserved">Tüm Hakları Saklıdır. Bu içerik eğitim amaçlıdır.</span></p>
        </footer>
    </div>

    <div id="riddle-screen" class="max-w-5xl mx-auto hidden">
        <div class="bg-slate-800 bg-opacity-90 rounded-3xl p-6 md:p-8 shadow-xl tech-bg glow">
            <div class="flex flex-col items-center justify-center py-8">
                <button id="btn-main-menu-riddle" class="btn-nav bg-slate-900 text-purple-400 border border-purple-700 rounded-lg px-4 py-2 font-medium shadow-sm hover:bg-slate-800 tech-font mb-4">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline mr-1" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd" />
                    </svg>
                    <span data-lang-key="main_menu_button">ANA MENÜ</span>
                </button>
                <h1 class="tech-font text-3xl md:text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-400 mb-6" data-lang-key="riddle_title">
                    YAPAY ZEKA BİLMECELERİ
                </h1>
                <p class="text-cyan-300 text-center mb-6" data-lang-key="riddle_intro">
                    Yapay zeka bilginizi test etme zamanı! Aşağıdaki bilmeceyi çözebilir misin?
                </p>
                <div class="w-full max-w-md bg-slate-900 p-6 rounded-xl border border-purple-500 shadow-lg">
                    <p id="riddle-question" class="text-purple-300 text-lg mb-4 text-center">
                        </p>
                    <input 
                        type="text" 
                        id="riddle-answer-input" 
                        class="bg-slate-800 text-purple-300 border border-purple-500 rounded-lg p-3 w-full mb-4 focus:outline-none focus:ring-2 focus:ring-purple-500 tech-font"
                        placeholder="Cevabını buraya yaz..."
                        data-lang-placeholder-key="riddle_input_placeholder"
                    >
                    <button 
                        id="submit-riddle-answer" 
                        class="bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-lg px-6 py-3 w-full font-medium shadow-sm hover:from-purple-600 hover:to-pink-600 transition-all tech-font"
                        data-lang-key="answer_button"
                    >
                        CEVAPLA
                    </button>
                    <button id="btn-riddle-hint" class="bg-gradient-to-r from-yellow-500 to-orange-500 text-white rounded-lg px-6 py-3 w-full font-medium shadow-sm hover:from-yellow-600 hover:to-orange-600 transition-all tech-font mt-4">
                        <span data-lang-key="riddle_hint_button">İPUCU AL</span> ✨
                    </button>
                    <p id="riddle-hint-text" class="text-center mt-4 text-yellow-300"></p>
                    <div id="riddle-hint-loading-indicator" class="hidden sound-wave ml-4 justify-center mt-4">
                        <span></span><span></span><span></span><span></span><span></span>
                    </div>
                    <p id="riddle-feedback" class="text-center mt-4 font-bold"></p>
                    <div id="riddle-loading-indicator" class="hidden sound-wave ml-4 justify-center mt-4">
                        <span></span><span></span><span></span><span></span><span></span>
                        </div>
                </div>
                <div class="mt-6 flex flex-col sm:flex-row justify-between w-full max-w-md space-y-4 sm:space-y-0">
                    <button id="btn-prev-riddle" class="btn-nav bg-slate-900 text-purple-400 border border-purple-700 rounded-lg px-5 py-2 font-medium shadow-sm hover:bg-slate-800 disabled:opacity-50 disabled:cursor-not-allowed tech-font">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline mr-1" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span data-lang-key="prev_button">ÖNCEKİ</span>
                    </button>
                    <span class="bg-gradient-to-r from-purple-900 to-pink-900 text-white py-2 px-4 rounded-full text-sm font-bold tech-font">
                        <span data-lang-key="riddle_count_label">BİLMECE</span>: <span id="riddle-count">0</span>/<span id="riddle-total">0</span>
                    </span>
                    <button id="btn-next-riddle" class="btn-nav bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-lg px-5 py-2 font-medium shadow-sm hover:from-purple-700 hover:to-pink-700 disabled:opacity-50 disabled:cursor-not-allowed tech-font">
                        <span data-lang-key="next_button">SONRAKİ</span>
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline ml-1" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4-4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="matching-game-screen" class="max-w-5xl mx-auto hidden">
        <div class="bg-slate-800 bg-opacity-90 rounded-3xl p-6 md:p-8 shadow-xl tech-bg glow">
            <div class="flex flex-col items-center justify-center py-8">
                <button id="btn-main-menu-matching" class="btn-nav bg-slate-900 text-green-400 border border-green-700 rounded-lg px-4 py-2 font-medium shadow-sm hover:bg-slate-800 tech-font mb-4">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline mr-1" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd" />
                    </svg>
                    <span data-lang-key="main_menu_button">ANA MENÜ</span>
                </button>
                <h1 class="tech-font text-3xl md:text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-green-400 to-emerald-400 mb-6" data-lang-key="matching_game_title">
                    EŞLEŞTİRME OYUNU
                </h1>
                <p class="text-cyan-300 text-center mb-6" data-lang-key="matching_game_intro">
                    Kartları çevir ve aynı kavramları eşleştir!
                </p>
                <div id="matching-grid" class="matching-grid w-full max-w-2xl">
                    </div>
                <p id="matching-feedback" class="text-center mt-4 font-bold text-green-400"></p>
                <div class="mt-6 flex flex-col sm:flex-row justify-center w-full max-w-md space-y-4 sm:space-y-0 sm:space-x-4">
                    <button id="btn-reset-matching" class="btn-nav bg-slate-900 text-green-400 border border-green-700 rounded-lg px-5 py-2 font-medium shadow-sm hover:bg-slate-800 tech-font">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z" clip-rule="evenodd" />
                        </svg>
                        <span data-lang-key="reset_matching_button">YENİDEN BAŞLA</span>
                    </button>
                    <button id="btn-complete-matching" class="hidden ml-4 bg-gradient-to-r from-green-600 to-emerald-600 text-white rounded-lg px-8 py-3 font-medium shadow-lg hover:from-green-700 hover:to-emerald-700 tech-font">
                        <span class="relative inline-block" data-lang-key="get_certificate_button">
                            SERTİFİKANI AL!
                            <span class="absolute top-0 right-0 -mt-2 -mr-2 bg-yellow-400 text-xs rounded-full h-5 w-5 flex items-center justify-center">
                                🌟
                            </span>
                        </span>
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <div id="certificate-screen" class="max-w-5xl mx-auto hidden">
        <div class="certificate p-8 rounded-3xl shadow-2xl flex flex-col items-center justify-center text-center relative h-[600px] md:h-[700px]">
            <div class="flex justify-between items-center w-full mb-6 absolute top-4 left-0 px-8">
                <button id="btn-back-to-game" class="bg-slate-800 text-cyan-400 border border-cyan-700 rounded-lg px-4 py-2 font-medium shadow-sm hover:bg-slate-700 tech-font">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline mr-1" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd" />
                    </svg>
                    <span data-lang-key="back_to_game">GERİ DÖN</span>
                </button>
                <button id="btn-print-certificate" class="bg-slate-800 text-cyan-400 border border-cyan-700 rounded-lg px-4 py-2 font-medium shadow-sm hover:bg-slate-700 tech-font">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline mr-1" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M5 4V2a2 2 0 012-2h6a2 2 0 012 2v2h2a2 2 0 012 2v7a2 2 0 01-2 2H3a2 2 0 01-2-2V6a2 2 0 012-2h2zm0 2h10v7a1 1 0 001 1H4a1 1 0 00-1 1V6h2zm6 10a1 1 0 100 2 1 1 0 000-2z" clip-rule="evenodd" />
                    </svg>
                    <span data-lang-key="print_certificate">YAZDIR</span>
                </button>
            </div>

            <div class="flex flex-col items-center justify-center flex-grow py-12">
                <h1 class="tech-font text-4xl md:text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-yellow-400 to-orange-500 mb-6 drop-shadow-lg" data-lang-key="certificate_main_title">
                    YAPAY ZEKADA UZMANLIK SERTİFİKASI
                </h1>
                <p class="text-xl md:text-2xl text-white mb-4" data-lang-key="certificate_honored">Bu sertifika ile onurlandırılmıştır:</p>
                <p id="certificate-user-name" class="tech-font text-5xl md:text-6xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-cyan-300 to-purple-400 mb-8 drop-shadow-lg">
                    [KULLANICI ADI]
                </p>
                <p class="text-lg md:text-xl text-white mb-8" id="certificate-message">
                    </p>
                <div class="flex items-center space-x-4 text-white">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-yellow-400" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                    </svg>
                    <span class="text-lg font-semibold" data-lang-key="congratulations">Tebrikler!</span>
                </div>
            </div>
            <p class="text-sm text-slate-400 mt-auto">
                <span data-lang-key="date_issued">Veriliş Tarihi:</span> <span id="certificate-date"></span>
            </p>
        </div>
        <footer class="mt-12 p-6 bg-slate-900 bg-opacity-90 rounded-3xl text-slate-400 text-center text-sm tech-font shadow-xl border border-slate-700">
            <h3 class="text-lg font-bold text-cyan-300 mb-2" data-lang-key="about_title">Hakkında</h3>
            <p class="mb-4" data-lang-key="about_text">
                Bu sayfada yer alan bilgiler, kaynak gösterilen içeriklerden derlenmiştir. Sertifikanın yasal bir geçerliliği yoktur, sadece eğitim amacıyla ve kar gütmeden hazırlanmıştır.
            </p>
            <h3 class="text-lg font-bold text-cyan-300 mb-2" data-lang-key="contact_title">İletişim</h3>
            <p class="mb-2">
                <span data-lang-key="contact_message">Sorularınız veya geri bildirimleriniz için LinkedIn üzerinden iletişime geçebilirsiniz:</span>
            </p>
            <p class="mb-4">
                <a href="https://www.linkedin.com/in/semayy" target="_blank" class="text-blue-400 hover:underline">linkedin.com/in/semayy</a>
            </p>
            <p class="font-bold text-cyan-300">Semanur Ayyıldız</p>
            <p class="text-xs text-slate-500">Görsel İletişim Tasarımı ve Dijital Dönüşüm Uzmanı</p>
            <p class="mt-4 text-xs text-slate-500">© 2025 <span data-lang-key="all_rights_reserved">Tüm Hakları Saklıdır. Bu içerik eğitim amaçlıdır.</span></p>
        </footer>
    </div>

    <div id="custom-confirm-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <p id="modal-message" class="text-lg mb-6"></p>
            <div class="modal-buttons">
                <button id="modal-confirm-btn" class="bg-gradient-to-r from-green-600 to-emerald-600 text-white rounded-lg px-6 py-2 font-medium shadow-sm hover:from-green-700 hover:to-emerald-700 tech-font">
                    Evet
                </button>
                <button id="modal-cancel-btn" class="bg-gradient-to-r from-red-600 to-orange-600 text-white rounded-lg px-6 py-2 font-medium shadow-sm hover:from-red-700 hover:to-orange-700 tech-font">
                    Hayır
                </button>
            </div>
        </div>
    </div>

    <script>
        // Text-to-Speech API (can be outside DOMContentLoaded)
        const synth = window.speechSynthesis;
        let speechUtterance = null;

        // Click Sound (simple beep as data URI) (can be outside DOMContentLoaded)
        const clickSound = new Audio('data:audio/wav;base64,UklGRyQAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQAAAAkBAAAAAQ=='); // A very short, subtle beep

        // THREE.js Global Variables
        let scene, camera, renderer, robot;
        let mouseX = 0, mouseY = 0;
        let windowHalfX = window.innerWidth / 2;
        let windowHalfY = window.innerHeight / 2;

        // Function to initialize the 3D robot animation
        function initRobotAnimation() {
            const container = document.getElementById('robot-canvas');
            if (!container) {
                console.error("Robot canvas element not found!");
                return;
            }

            // Scene
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x1a243a); // Match background of the card

            // Camera
            camera = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 1000);
            camera.position.z = 2;

            // Renderer
            renderer = new THREE.WebGLRenderer({ canvas: container, antialias: true, alpha: true });
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.setSize(container.clientWidth, container.clientHeight);

            // Lights
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
            scene.add(ambientLight);
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(1, 1, 1).normalize();
            scene.add(directionalLight);

            // Create Robot
            robot = new THREE.Group();

            // Body (Cylinder)
            const bodyGeometry = new THREE.CylinderGeometry(0.3, 0.3, 0.8, 32);
            const bodyMaterial = new THREE.MeshPhongMaterial({ color: 0x38bdf8, flatShading: true });
            const body = new THREE.Mesh(bodyGeometry, bodyMaterial);
            robot.add(body);

            // Head (Sphere)
            const headGeometry = new THREE.SphereGeometry(0.4, 32, 32);
            const headMaterial = new THREE.MeshPhongMaterial({ color: 0xa855f7, flatShading: true });
            const head = new THREE.Mesh(headGeometry, headMaterial);
            head.position.y = 0.6;
            robot.add(head);

            // Eyes (Cylinders)
            const eyeGeometry = new THREE.CylinderGeometry(0.05, 0.05, 0.1, 16);
            const eyeMaterial = new THREE.MeshPhongMaterial({ color: 0xffffff });
            const leftEye = new THREE.Mesh(eyeGeometry, eyeMaterial);
            leftEye.position.set(-0.15, 0.65, 0.35);
            leftEye.rotation.x = Math.PI / 2;
            robot.add(leftEye);
            const rightEye = new THREE.Mesh(eyeGeometry, eyeMaterial);
            rightEye.position.set(0.15, 0.65, 0.35);
            rightEye.rotation.x = Math.PI / 2;
            robot.add(rightEye);

            // Mouth (Box)
            const mouthGeometry = new THREE.BoxGeometry(0.2, 0.05, 0.05);
            const mouthMaterial = new THREE.MeshPhongMaterial({ color: 0x0d1222 });
            const mouth = new THREE.Mesh(mouthGeometry, mouthMaterial);
            mouth.position.set(0, 0.5, 0.4);
            robot.add(mouth);

            // Antennas (Cylinders and Spheres)
            const antennaGeometry = new THREE.CylinderGeometry(0.02, 0.02, 0.2, 8);
            const antennaMaterial = new THREE.MeshPhongMaterial({ color: 0xf472b6 });
            const antennaTipGeometry = new THREE.SphereGeometry(0.05, 16, 16);
            const antennaTipMaterial = new THREE.MeshPhongMaterial({ color: 0x38bdf8 });

            const leftAntenna = new THREE.Mesh(antennaGeometry, antennaMaterial);
            leftAntenna.position.set(-0.25, 0.9, 0);
            const leftAntennaTip = new THREE.Mesh(antennaTipGeometry, antennaTipMaterial);
            leftAntennaTip.position.y = 0.1;
            leftAntenna.add(leftAntennaTip);
            robot.add(leftAntenna);

            const rightAntenna = new THREE.Mesh(antennaGeometry, antennaMaterial);
            rightAntenna.position.set(0.25, 0.9, 0);
            const rightAntennaTip = new THREE.Mesh(antennaTipGeometry, antennaTipMaterial);
            rightAntennaTip.position.y = 0.1;
            rightAntenna.add(rightAntennaTip);
            robot.add(rightAntenna);

            scene.add(robot);

            // Mouse interaction for camera rotation
            container.addEventListener('mousemove', onDocumentMouseMove, false);
            container.addEventListener('touchmove', onDocumentTouchMove, false);

            // Handle window resize
            window.addEventListener('resize', onWindowResize, false);

            // Start animation loop
            animateRobot();
        }

        function onDocumentMouseMove(event) {
            mouseX = (event.clientX - windowHalfX) / 100;
            mouseY = (event.clientY - windowHalfY) / 100;
        }

        function onDocumentTouchMove(event) {
            if (event.touches.length === 1) {
                event.preventDefault();
                mouseX = (event.touches[0].pageX - windowHalfX) / 100;
                mouseY = (event.touches[0].pageY - windowHalfY) / 100;
            }
        }

        function onWindowResize() {
            const container = document.getElementById('robot-canvas');
            if (container) {
                camera.aspect = container.clientWidth / container.clientHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(container.clientWidth, container.clientHeight);
            }
        }

        function animateRobot() {
            requestAnimationFrame(animateRobot);

            // Rotate robot based on mouse position
            robot.rotation.y += (mouseX - robot.rotation.y) * 0.05;
            robot.rotation.x += (-mouseY - robot.rotation.x) * 0.05;

            // Subtle floating animation
            robot.position.y = Math.sin(Date.now() * 0.001) * 0.1;

            renderer.render(scene, camera);
        }


        document.addEventListener('DOMContentLoaded', () => {
            // DOM element references
            const welcomeScreen = document.getElementById('welcome-screen');
            const gameScreen = document.getElementById('game-screen');
            const riddleScreen = document.getElementById('riddle-screen');
            const matchingGameScreen = document.getElementById('matching-game-screen');
            const certificateScreen = document.getElementById('certificate-screen');

            // New intro elements
            const initialIntroScreen = document.getElementById('initial-intro-screen');
            const continueIntroBtn = document.getElementById('continue-intro-btn');
            const nameInputSection = document.getElementById('name-input-section'); // The original section with name input

            const startAdventureBtn = document.getElementById('start-adventure');
            const userNameInput = document.getElementById('user-name');
            const userNameDisplay = document.getElementById('user-name-display');
            const certificateUserName = document.getElementById('certificate-user-name');
            const certificateDate = document.getElementById('certificate-date');
            const certificateMessage = document.getElementById('certificate-message');

            // Language Toggle
            const langToggleTr = document.getElementById('lang-toggle-tr');
            const langToggleEn = document.getElementById('lang-toggle-en');

            // Learning Card elements
            const currentCardElement = document.getElementById('current-card');
            const cardFrontTitle = document.getElementById('card-front-title');
            const cardFrontText = document.getElementById('card-front-text');
            const cardFrontSvg = document.getElementById('card-front-svg');
            const cardBackTitle = document.getElementById('card-back-title');
            const cardBackText = document.getElementById('card-back-text');
            const cardBadge = document.getElementById('card-badge');
            const btnPrev = document.getElementById('btn-prev');
            const btnNext = document.getElementById('btn-next');
            const btnKnown = document.getElementById('btn-known');
            const btnUnknown = document.getElementById('btn-unknown');
            const btnListenStory = document.getElementById('btn-listen-story'); 
            const btnToggleStory = document.getElementById('btn-toggle-story'); // New button for alternative story
            const toggleStoryButtonText = document.getElementById('toggle-story-button-text'); // Text element for the toggle button

            // Ask Ronin elements
            const roninQuestionInput = document.getElementById('ronin-question-input'); 
            const askRoninBtn = document.getElementById('ask-ronin-btn'); 
            const roninAnswer = document.getElementById('ronin-answer'); 
            const roninLoadingIndicator = document.getElementById('ronin-loading-indicator'); 

            // AI Story Generator elements
            const storyKeywordsInput = document.getElementById('story-keywords-input');
            const generateStoryBtn = document.getElementById('generate-story-btn');
            const storyText = document.getElementById('story-text');
            const storyLoadingIndicator = document.getElementById('story-loading-indicator');

            // "What Does This AI Do?" Scenario Generator elements
            const scenarioInput = document.getElementById('scenario-input');
            const analyzeScenarioBtn = document.getElementById('analyze-scenario-btn');
            const scenarioAnalysisText = document.getElementById('scenario-analysis-text');
            const scenarioLoadingIndicator = document.getElementById('scenario-loading-indicator');

            // AI Fun Fact Generator elements
            const generateFunFactBtn = document.getElementById('generate-fun-fact-btn');
            const funFactText = document.getElementById('fun-fact-text');
            const funFactLoadingIndicator = document.getElementById('fun-fact-loading-indicator');

            // AI Invention Idea Generator elements
            const inventionTopicInput = document.getElementById('invention-topic-input');
            const generateInventionBtn = document = document.getElementById('generate-invention-btn');
            const inventionText = document.getElementById('invention-text');
            const inventionLoadingIndicator = document.getElementById('invention-loading-indicator');

            // NEW: AI Game Idea Generator elements
            const gameThemeInput = document.getElementById('game-theme-input');
            const generateGameIdeaBtn = document.getElementById('generate-game-idea-btn');
            const gameIdeaText = document.getElementById('game-idea-text');
            const gameIdeaLoadingIndicator = document.getElementById('game-idea-loading-indicator');

            // Riddle elements
            const riddleQuestion = document.getElementById('riddle-question');
            const riddleAnswerInput = document.getElementById('riddle-answer-input');
            const submitRiddleAnswerBtn = document.getElementById('submit-riddle-answer');
            const riddleFeedback = document.getElementById('riddle-feedback');
            const btnPrevRiddle = document.getElementById('btn-prev-riddle');
            const btnNextRiddle = document.getElementById('btn-next-riddle');
            const riddleCountDisplay = document.getElementById('riddle-count');
            const riddleTotalDisplay = document = document.getElementById('riddle-total'); // New total riddles display
            const riddleLoadingIndicator = document.getElementById('riddle-loading-indicator');
            // New riddle hint elements
            const btnRiddleHint = document.getElementById('btn-riddle-hint');
            const riddleHintText = document.getElementById('riddle-hint-text');
            const riddleHintLoadingIndicator = document.getElementById('riddle-hint-loading-indicator');


            // Matching Game elements
            const matchingGrid = document.getElementById('matching-grid');
            const matchingFeedback = document.getElementById('matching-feedback');
            const btnResetMatching = document.getElementById('btn-reset-matching');
            const btnCompleteMatching = document.getElementById('btn-complete-matching');

            // Overall progress elements
            const overallProgressCountDisplay = document.getElementById('overall-progress-count');
            const overallTotalCountDisplay = document = document.getElementById('overall-total-count');
            const progressBar = document.getElementById('progress-bar');
            const progressPercent = document.getElementById('progress-percent');
            const statsKnown = document.getElementById('stats-known');
            const statsUnknown = document.getElementById('stats-unknown');
            const statsRemaining = document.getElementById('stats-remaining');
            const btnReset = document.getElementById('btn-reset');
            
            const starsContainer = document.getElementById('stars');

            // Certificate screen buttons
            const btnBackToGame = document.getElementById('btn-back-to-game');
            const btnPrintCertificate = document.getElementById('btn-print-certificate');
            const btnGetCertificate = document.getElementById('btn-get-certificate');
            const certificateButtonContainer = document.getElementById('certificate-button-container');

            // Custom Modal elements
            const customConfirmModal = document.getElementById('custom-confirm-modal');
            const modalMessage = document.getElementById('modal-message');
            const modalConfirmBtn = document.getElementById('modal-confirm-btn');
            const modalCancelBtn = document.getElementById('modal-cancel-btn');

            // Main Menu buttons
            const btnMainMenuGame = document.getElementById('btn-main-menu-game');
            const btnMainMenuRiddle = document.getElementById('btn-main-menu-riddle');
            const btnMainMenuMatching = document.getElementById('btn-main-menu-matching');


            // Game state variables
            let userName = '';
            let currentSection = 'intro'; // 'intro', 'learning', 'riddles', 'matching'
            let currentCardIndex = 0;
            let currentRiddleIndex = 0;
            let currentLanguage = 'tr'; // Default language
            let isPrimaryStory = true; // For toggling between primary and alternative story

            let knownCards = new Set(); // Stores indices of learning cards marked as "Anladım"
            let unknownCards = new Set(); // Stores indices of learning cards marked as "Tekrar"
            let solvedRiddles = new Set(); // Stores indices of solved riddles (conceptIndex_riddleIndex)
            let matchedPairs = new Set(); // Stores IDs of matched pairs in matching game

            // Matching game specific state
            let flippedCards = [];
            let lockBoard = false;

            // Translations object
            const translations = {
                'tr': {
                    'welcome_title': 'YAPAY ZEKA MACERASI',
                    'intro_message': 'Çocuklar, ebeveynlerinizle birlikte misiniz? Eğer size eşlik edecek bir yetişkin varsa, haydi başlayalım!',
                    'continue_button': 'DEVAM ET',
                    'welcome_intro': 'Merhaba genç kaşif! Yapay zeka dünyasına heyecan verici bir yolculuğa çıkmaya hazır mısın?',
                    'enter_name': 'İSMİNİ GİR:',
                    'name_placeholder': 'Adın ve Soyadın',
                    'start_button': 'BAŞLA',
                    'name_hint': '* İsmin sertifikanda görünecek',
                    'learn_title': 'ÖĞREN',
                    'learn_text': 'Yapay zeka hakkında eğlenceli hikayeler ve açıklamalarla yeni bilgiler öğren.',
                    'explore_title': 'KEŞFET',
                    'explore_text': 'Robotlar ve yapay zeka dünyasını interaktif kartlarla keşfet.',
                    'certificate_title': 'SERTİFİKA',
                    'certificate_text': 'Tüm kartları tamamla ve kendi özel yapay zeka sertifikanı kazan!',
                    'hello_explorer': 'Merhaba',
                    'ready_to_explore': '! Yapay zeka dünyasını keşfetmeye hazır mısın?',
                    'progress': 'İLERLEME',
                    'progress_bar_label': 'İLERLEME ÇUBUĞU',
                    'child_friendly': 'ÇOCUK DOSTU',
                    'concept': 'KAVRAM',
                    'flip_card_hint': 'HİKAYEYİ OKUMAK İÇİN KARTI ÇEVİR',
                    'listen_story_button': 'DİNLE', 
                    'listening_story_button': 'Dinleniyor...',
                    'toggle_story_button': 'AI ile Oluştur', // Updated text
                    'prev_button': 'ÖNCEKİ',
                    'next_button': 'SONRAKİ',
                    'understood_button': 'ANLADIM',
                    'repeat_button': 'TEKRAR',
                    'learning_stats': 'ÖĞRENME İSTATİSTİKLERİ',
                    'total_cards': 'TOPLAM KART',
                    'understood': 'ANLAŞILAN',
                    'to_repeat': 'TEKRAR EDİLECEK',
                    'remaining': 'KALAN',
                    'reset_button': 'SIFIRLA',
                    'ask_ronin_title': '✨ Ronin\'e Soru Sor', 
                    'ask_ronin_prompt': 'Yapay zeka hakkında bir soru sor:', 
                    'ask_ronin_placeholder': 'Örn: Robotlar rüya görür mü?', 
                    'ask_ronin_button': 'SOR ✨', 
                    'ronin_thinking': 'Ronin düşünüyor...', 
                    'ronin_answer_placeholder': 'Ronin\'in cevabını bekliyorum...', 
                    'ronin_no_question': 'Lütfen bir soru yaz!', 
                    'ronin_api_error': 'Üzgünüm, şu an cevap veremiyorum. Daha sonra tekrar dene.', 
                    'ai_story_generator_title': '✨ Yapay Zeka Hikaye Oluşturucu',
                    'story_keywords_prompt': 'Hikayende hangi anahtar kelimeler olsun? (virgülle ayır)',
                    'story_keywords_placeholder': 'Örn: robot, uzay, arkadaşlık',
                    'generate_story_button': 'HİKAYE OLUŞTUR ✨',
                    'story_placeholder': 'Hikayen burada belirecek...',
                    'story_no_keywords': 'Lütfen hikaye oluşturmak için anahtar kelimeler girin!',
                    'story_loading': 'Hikaye oluşturuluyor...',
                    'story_api_error': 'Hikaye oluşturulurken bir hata oluştu. Lütfen tekrar dene.',
                    'ai_scenario_title': '✨ Yapay Zeka Ne Yapar?',
                    'scenario_prompt': 'Bir senaryo yaz:',
                    'scenario_placeholder': 'Örn: Bir robot hastanede',
                    'analyze_scenario_button': 'ANALİZ ET ✨',
                    'scenario_analysis_placeholder': 'Yapay zeka bu senaryoda ne yapabilir?',
                    'scenario_no_input': 'Lütfen bir senaryo yazın!',
                    'scenario_loading': 'Senaryo analiz ediliyor...',
                    'scenario_api_error': 'Senaryo analiz edilirken bir hata oluştu. Lütfen tekrar dene.',
                    'ai_fun_fact_title': '✨ Yapay Zeka Eğlenceli Bilgi',
                    'generate_fun_fact_button': 'EĞLENCELİ BİLGİ OLUŞTUR ✨',
                    'fun_fact_placeholder': 'Yapay zeka hakkında eğlenceli bir bilgi burada belirecek...',
                    'fun_fact_loading': 'Eğlenceli bilgi oluşturuluyor...',
                    'fun_fact_api_error': 'Eğlenceli bilgi oluşturulurken bir hata oluştu. Lütfen tekrar dene.',
                    'ai_invention_title': '✨ Yapay Zeka İcat Fikri',
                    'invention_topic_prompt': 'Hangi konuda icat fikri istersin?',
                    'invention_topic_placeholder': 'Örn: evcil hayvanlar, çevre, oyunlar',
                    'generate_invention_button': 'İCAT FİKRİ OLUŞTUR ✨',
                    'invention_placeholder': 'Yapay zeka icat fikrin burada belirecek...',
                    'invention_loading': 'İcat fikri oluşturuluyor...',
                    'invention_no_topic': 'Lütfen bir icat konusu girin!',
                    'invention_api_error': 'İcat fikri oluşturulurken bir hata oluştu. Lütfen tekrar dene.',
                    'ai_game_idea_title': '✨ Yapay Zeka Oyun Fikri',
                    'game_theme_prompt': 'Hangi konuda oyun fikri istersin?',
                    'game_theme_placeholder': 'Örn: uzay, hayvanlar, macera',
                    'generate_game_idea_button': 'OYUN FİKRİ OLUŞTUR ✨',
                    'game_idea_placeholder': 'Oyun fikrin burada belirecek...',
                    'game_idea_loading': 'Oyun fikri oluşturuluyor...',
                    'game_idea_no_theme': 'Lütfen bir oyun teması girin!',
                    'game_idea_api_error': 'Oyun fikri oluşturulurken bir hata oluştu. Lütfen tekrar dene.',
                    'riddle_title': 'YAPAY ZEKA BİLMECELERİ',
                    'riddle_intro': 'Yapay zeka bilginizi test etme zamanı! Aşağıdaki bilmeceyi çözebilir misin?',
                    'riddle_input_placeholder': 'Cevabını buraya yaz...',
                    'answer_button': 'CEVAPLA',
                    'riddle_hint_button': 'İPUCU AL',
                    'riddle_hint_loading': 'İpucu oluşturuluyor...',
                    'riddle_hint_error': 'İpucu oluşturulurken bir hata oluştu.',
                    'riddle_correct': 'Doğru! Harikasın!',
                    'riddle_incorrect': 'Yanlış cevap. Tekrar dene!',
                    'riddle_loading': 'Bilmeceler yükleniyor...',
                    'riddle_load_error': 'Bilmeceler yüklenemedi. Lütfen tekrar deneyin.',
                    'riddle_api_error': 'Bilmeceler yüklenirken bir hata oluştu.',
                    'riddle_count_label': 'BİLMECE',
                    'proceed_to_matching': 'EŞLEŞTİRME OYUNUNA GEÇ',
                    'matching_game_title': 'EŞLEŞTİRME OYUNU',
                    'matching_game_intro': 'Kartları çevir ve aynı kavramları eşleştir!',
                    'matching_matched': 'Eşleşti!',
                    'matching_not_matched': 'Eşleşmedi, tekrar dene!',
                    'matching_all_matched': 'Tebrikler! Tüm çiftleri eşleştirdin!',
                    'reset_matching_button': 'YENİDEN BAŞLA',
                    'get_certificate_button': 'SERTİFİKANI AL!',
                    'certificate_main_title': 'YAPAY ZEKADA UZMANLIK SERTİFİKASI',
                    'certificate_honored': 'Bu sertifika ile onurlandırılmıştır:',
                    'certificate_completion_text': 'Yapay zeka macera derslerini başarıyla tamamladığı için.',
                    'congratulations': 'Tebrikler!',
                    'date_issued': 'Veriliş Tarihi:',
                    'back_to_game': 'GERİ DÖN',
                    'print_certificate': 'YAZDIR',
                    'certificate_message_loading': 'Mesajınız oluşturuluyor...',
                    'certificate_message_default': 'Tebrikler! Yapay zeka maceranı başarıyla tamamladın!',
                    'confirm_reset': 'Tüm ilerlemenizi sıfırlamak istediğinizden emin misiniz?',
                    'about_title': 'Hakkında',
                    'about_text': 'Bu sayfada yer alan bilgiler, kaynak gösterilen içeriklerden derlenmiştir. Sertifikanın yasal bir geçerliliği yoktur, sadece eğitim amacıyla ve kar gütmeden hazırlanmıştır.',
                    'contact_title': 'İletişim',
                    'contact_message': 'Sorularınız veya geri bildirimleriniz için LinkedIn üzerinden iletişime geçebilirsiniz:',
                    'all_rights_reserved': 'Tüm Hakları Saklıdır. Bu içerik eğitim amaçlıdır.',
                    'modal_confirm_title': 'Onay',
                    'modal_reset_message': 'Tüm ilerlemenizi sıfırlamak istediğinizden emin misiniz?',
                    'proceed_to_riddles': 'BİLMECEYE GEÇ',
                    'learning_complete_message': 'Tebrikler! Tüm öğrenme kartlarını tamamladın!',
                    'riddles_complete_message': 'Harika! Tüm bilmeceleri çözdün!',
                    'matching_complete_message': 'Muhteşem! Tüm çiftleri eşleştirdin!',
                    'main_menu_button': 'ANA MENÜ',
                    'generating_story': 'Hikaye Oluşturuluyor...',
                    'story_generation_error': 'Hikaye oluşturulurken bir hata oluştu. Lütfen tekrar dene.'
                },
                'en': {
                    'welcome_title': 'AI ADVENTURE',
                    'intro_message': 'Kids, are you with your parents? If you have an adult accompanying you, let\'s begin!',
                    'continue_button': 'CONTINUE',
                    'welcome_intro': 'Hello young explorer! Are you ready for an exciting journey into the world of artificial intelligence?',
                    'enter_name': 'ENTER YOUR NAME:',
                    'name_placeholder': 'Your Name and Surname',
                    'start_button': 'START',
                    'name_hint': '* Your name will appear on your certificate',
                    'learn_title': 'LEARN',
                    'learn_text': 'Learn new things about artificial intelligence with fun stories and explanations.',
                    'explore_title': 'EXPLORE',
                    'explore_text': 'Explore the world of robots and artificial intelligence with interactive cards.',
                    'certificate_title': 'CERTIFICATE',
                    'certificate_text': 'Complete all cards and earn your special AI certificate!',
                    'hello_explorer': 'Hello',
                    'ready_to_explore': '! Are you ready to explore the world of artificial intelligence?',
                    'progress': 'PROGRESS',
                    'progress_bar_label': 'PROGRESS BAR',
                    'child_friendly': 'CHILD FRIENDLY',
                    'concept': 'CONCEPT',
                    'flip_card_hint': 'FLIP THE CARD TO READ THE STORY',
                    'listen_story_button': 'LISTEN', 
                    'listening_story_button': 'Listening...',
                    'toggle_story_button': 'Generate with AI', // Updated text
                    'prev_button': 'PREVIOUS',
                    'next_button': 'NEXT',
                    'understood_button': 'UNDERSTOOD',
                    'repeat_button': 'REPEAT',
                    'learning_stats': 'LEARNING STATISTICS',
                    'total_cards': 'TOTAL CARDS',
                    'understood': 'UNDERSTOOD',
                    'to_repeat': 'TO REPEAT',
                    'remaining': 'REMAINING',
                    'reset_button': 'RESET',
                    'ask_ronin_title': '✨ Ask Ronin', 
                    'ask_ronin_prompt': 'Ask a question about artificial intelligence:', 
                    'ask_ronin_placeholder': 'Ex: Do robots dream?', 
                    'ask_ronin_button': 'ASK ✨', 
                    'ronin_thinking': 'Ronin is thinking...', 
                    'ronin_answer_placeholder': 'Waiting for Ronin\'s answer...', 
                    'ronin_no_question': 'Please write a question!', 
                    'ronin_api_error': 'Sorry, I cannot answer right now. Please try again later.', 
                    'ai_story_generator_title': '✨ AI Story Generator',
                    'story_keywords_prompt': 'What keywords should be in your story? (separate with commas)',
                    'story_keywords_placeholder': 'Ex: robot, space, friendship',
                    'generate_story_button': 'GENERATE STORY ✨',
                    'story_placeholder': 'Your story will appear here...',
                    'story_no_keywords': 'Please enter keywords to generate a story!',
                    'story_loading': 'Generating story...',
                    'story_api_error': 'An error occurred while generating the story. Please try again.',
                    'ai_scenario_title': '✨ What Does This AI Do?',
                    'scenario_prompt': 'Write a scenario:',
                    'scenario_placeholder': 'Ex: A robot in a hospital',
                    'analyze_scenario_button': 'ANALYZE ✨',
                    'scenario_no_input': 'Please write a scenario!',
                    'scenario_loading': 'Analyzing scenario...',
                    'scenario_api_error': 'An error occurred while analyzing the scenario. Please try again.',
                    'ai_fun_fact_title': '✨ AI Fun Fact',
                    'generate_fun_fact_button': 'GENERATE FUN FACT ✨',
                    'fun_fact_placeholder': 'A fun fact about AI will appear here...',
                    'fun_fact_loading': 'Generating fun fact...',
                    'fun_fact_api_error': 'An error occurred while generating the fun fact. Please try again.',
                    'ai_invention_title': '✨ AI Invention Idea',
                    'invention_topic_prompt': 'What topic would you like an invention idea for?',
                    'invention_topic_placeholder': 'Ex: pets, environment, games',
                    'generate_invention_button': 'GENERATE INVENTION IDEA ✨',
                    'invention_placeholder': 'Your AI invention idea will appear here...',
                    'invention_loading': 'Generating invention idea...',
                    'invention_no_topic': 'Please enter an invention topic!',
                    'invention_api_error': 'An error occurred while generating the invention idea. Please try again.',
                    'ai_game_idea_title': '✨ AI Game Idea',
                    'game_theme_prompt': 'Hangi konuda oyun fikri istersin?',
                    'game_theme_placeholder': 'Örn: uzay, hayvanlar, macera',
                    'generate_game_idea_button': 'OYUN FİKRİ OLUŞTUR ✨',
                    'game_idea_placeholder': 'Oyun fikrin burada belirecek...',
                    'game_idea_loading': 'Oyun fikri oluşturuluyor...',
                    'game_idea_no_theme': 'Lütfen bir oyun teması girin!',
                    'game_idea_api_error': 'Oyun fikri oluşturulurken bir hata oluştu. Lütfen tekrar dene.',
                    'riddle_title': 'AI RIDDLES',
                    'riddle_intro': 'Time to test your AI knowledge! Can you solve the riddle below?',
                    'riddle_input_placeholder': 'Type your answer here...',
                    'answer_button': 'ANSWER',
                    'riddle_hint_button': 'GET HINT',
                    'riddle_hint_loading': 'Generating hint...',
                    'riddle_hint_error': 'An error occurred while generating a hint.',
                    'riddle_correct': 'Correct! You\'re amazing!',
                    'riddle_incorrect': 'Wrong answer. Try again!',
                    'riddle_loading': 'Loading riddles...',
                    'riddle_load_error': 'Could not load riddles. Please try again.',
                    'riddle_api_error': 'An error occurred while loading riddles.',
                    'riddle_count_label': 'RIDDLE',
                    'proceed_to_matching': 'PROCEED TO MATCHING GAME',
                    'matching_game_title': 'MATCHING GAME',
                    'matching_game_intro': 'Flip the cards and match the same concepts!',
                    'matching_matched': 'Matched!',
                    'matching_not_matched': 'Not a match, try again!',
                    'matching_all_matched': 'Congratulations! You\'ve matched all pairs!',
                    'reset_matching_button': 'RESTART GAME',
                    'get_certificate_button': 'GET YOUR CERTIFICATE!',
                    'certificate_main_title': 'CERTIFICATE OF EXPERTISE IN ARTIFICIAL INTELLIGENCE',
                    'certificate_honored': 'This certificate is proudly presented to:',
                    'certificate_completion_text': 'For successfully completing the AI adventure lessons.',
                    'congratulations': 'Congratulations!',
                    'date_issued': 'Date Issued:',
                    'back_to_game': 'GO BACK',
                    'print_certificate': 'PRINT',
                    'certificate_message_loading': 'Generating your message...',
                    'certificate_message_default': 'Congratulations! You have successfully completed your AI adventure!',
                    'confirm_reset': 'Are you sure you want to reset all your progress?',
                    'about_title': 'About',
                    'about_text': 'The information on this page is compiled from cited sources. The certificate has no legal validity and is prepared solely for educational purposes and without profit.',
                    'contact_title': 'Contact',
                    'contact_message': 'For questions or feedback, you can contact via LinkedIn:',
                    'all_rights_reserved': 'All Rights Reserved. This content is for educational purposes.',
                    'modal_confirm_title': 'Confirm',
                    'modal_reset_message': 'Are you sure you want to reset all your progress?',
                    'proceed_to_riddles': 'PROCEED TO RIDDLES',
                    'learning_complete_message': 'Congratulations! You\'ve completed all learning cards!',
                    'riddles_complete_message': 'Great! You\'ve solved all the riddles!',
                    'matching_complete_message': 'Fantastic! You\'ve matched all the pairs!',
                    'main_menu_button': 'MAIN MENU',
                    'generating_story': 'Generating Story...',
                    'story_generation_error': 'An error occurred while generating the story. Please try again.'
                }
            };

            // AI Concepts data (learning cards) - Simplified for 6-year-olds
            const aiConcepts = [
                {
                    title: {
                        tr: "Yapay Zeka Nedir?",
                        en: "What is Artificial Intelligence?"
                    },
                    text: {
                        tr: "Yapay zeka, bilgisayarların insanlar gibi düşünebilmesini ve öğrenebilmesini sağlar.",
                        en: "Artificial intelligence allows computers to think and learn like humans."
                    },
                    storyTitle: {
                        tr: "Ronin'in Akıllı Beyni",
                        en: "Ronin's Smart Brain"
                    },
                    storyText: {
                        tr: "Bir gün küçük robot Zeka, çiçekleri sulamayı öğrenmek istedi. Anneannesi her sabah çiçekleri suluyordu. Zeka dikkatle izledi, sonra da aynısını yaptı! Her gün çiçekler artık Zeka’nın sayesinde açıyordu. Çünkü o artık öğrendi—tıpkı insanlar gibi!",
                        en: "One day, a small robot named Zeka wanted to learn how to water flowers. His grandmother watered the flowers every morning. Zeka watched carefully, then did the same! Every day, the flowers now bloomed thanks to Zeka. Because he had learned—just like humans!"
                    },
                    altStoryTitle: {
                        tr: "Akıllı Oyuncak Ayı",
                        en: "Smart Teddy Bear"
                    },
                    altStoryText: {
                        tr: "Minik Ayı Balo, en sevdiği oyuncaktı. Balo, Ayşe'nin sesini tanıyor, 'Seni seviyorum!' dediğinde karşılık veriyordu. Ayşe, Balo'nun nasıl bu kadar akıllı olduğunu merak etti. Meğer Balo'nun içinde, insan gibi düşünebilen minik bir beyin varmış!",
                        en: "Little Bear Balo was her favorite toy. Balo recognized Ayşe's voice and responded when she said 'I love you!' Ayşe wondered how Balo could be so smart. It turned out Balo had a tiny brain inside that could think like a human!"
                    },
                    generatedAltStory: { tr: null, en: null }, // To store AI-generated story
                    svg: `
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200" class="w-40 h-40">
                            <circle cx="100" cy="70" r="40" fill="#38bdf8" opacity="0.2" />
                            <circle cx="85" cy="60" r="8" fill="#38bdf8" class="robot-eye" />
                            <circle cx="115" cy="60" r="8" fill="#38bdf8" class="robot-eye" />
                            <path d="M85 85 Q100 100 115 85" stroke="#38bdf8" stroke-width="3" fill="none" />
                            <rect x="60" y="110" width="80" height="60" rx="10" fill="#38bdf8" opacity="0.2" />
                            <rect x="70" y="125" width="60" height="10" rx="5" fill="#38bdf8" opacity="0.5" />
                            <rect x="70" y="145" width="40" height="10" rx="5" fill="#38bdf8" opacity="0.5" />
                            <circle cx="70" cy="40" r="10" fill="#a855f7" opacity="0.3" />
                            <circle cx="130" cy="40" r="10" fill="#a855f7" opacity="0.3" />
                            <path d="M70 40 Q100 10 130 40" stroke="#a855f7" stroke-width="5" fill="none" opacity="0.3" />
                        </svg>
                    `,
                    riddles: [
                        {
                            question: { tr: "Ben bir beyin gibiyim ama bilgisayardayım. Öğrenirim, düşünürüm, bazen de oynarım. Adım ne?", en: "I'm like a brain but in a computer. I learn, I think, sometimes I even play. What's my name?" },
                            hint: { tr: "İki kelimeden oluşurum, ilk kelimem 'Y' ile başlar.", en: "I consist of two words, the first starts with 'A'." },
                            answer: "yapay zeka"
                        },
                        {
                            question: { tr: "Robotlar ve akıllı telefonlar benimle çalışır. Onlara ne yapacaklarını söylerim. Ben neyim?", en: "Robots and smartphones work with me. I tell them what to do. What am I?" },
                            hint: { tr: "Benimle birlikte 'zeka' kelimesi de kullanılır.", en: "The word 'intelligence' is also used with me." },
                            answer: "yapay zeka"
                        }
                    ]
                },
                {
                    title: {
                        tr: "Makine Öğrenmesi",
                        en: "Machine Learning"
                    },
                    text: {
                        tr: "Makine öğrenmesi, bilgisayarların deneyimden öğrenmesini sağlar.",
                        en: "Machine learning allows computers to learn from experience."
                    },
                    storyTitle: {
                        tr: "Maya ve Bilgisayarın Kedileri",
                        en: "Maya and the Computer's Cats"
                    },
                    storyText: {
                        tr: "Maya, bilgisayara kedilerin ve köpeklerin fotoğraflarını gösterdi. Başta bilgisayar karıştırdı. Ama ne kadar çok resim gösterildiyse, o kadar iyi öğrendi. Sonunda bilgisayar “Bu bir kedi!” demeyi başardı.",
                        en: "Maya showed the computer pictures of cats and dogs. At first, the computer got confused. But the more pictures it was shown, the better it learned. Finally, the computer managed to say, 'This is a cat!'"
                    },
                    altStoryTitle: {
                        tr: "Robot Ressam",
                        en: "Robot Painter"
                    },
                    altStoryText: {
                        tr: "Robot Ressam, ilk başta sadece düz çizgiler çizebiliyordu. Ama ona çok sayıda çiçek resmi gösterildi. Her resimden sonra daha güzel çiçekler çizmeye başladı. Artık harika tablolar yapabiliyor!",
                        en: "Robot Painter could only draw straight lines at first. But he was shown many flower pictures. After each picture, he started drawing more beautiful flowers. Now he can create amazing paintings!"
                    },
                    generatedAltStory: { tr: null, en: null }, // To store AI-generated story
                    svg: `
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200" class="w-40 h-40">
                            <path d="M100 20 C130 20, 140 50, 120 70 L120 130 C140 150, 130 180, 100 180 C70 180, 60 150, 80 130 L80 70 C60 50, 70 20, 100 20 Z" fill="#a855f7" opacity="0.2" />
                            <circle cx="85" cy="60" r="8" fill="#a855f7" class="robot-eye" />
                            <circle cx="115" cy="60" r="8" fill="#a855f7" class="robot-eye" />
                            <path d="M85 85 Q100 100 115 85" stroke="#a855f7" stroke-width="3" fill="none" />
                            <rect x="70" y="140" width="60" height="10" rx="5" fill="#a855f7" opacity="0.5" />
                            <circle cx="70" cy="160" r="10" fill="#38bdf8" opacity="0.3" />
                            <circle cx="130" cy="160" r="10" fill="#38bdf8" opacity="0.3" />
                            <path d="M70 160 Q100 190 130 160" stroke="#38bdf8" stroke-width="5" fill="none" opacity="0.3" />
                        </svg>
                    `,
                    riddles: [
                        {
                            question: { tr: "Resimler gösterince öğrenirim, hatalarımı düzeltirim. Beni eğiten kim, biliyor musun?", en: "I learn by being shown pictures, I correct my mistakes. Do you know who trains me?" },
                            hint: { tr: "Bilgisayarların akıllanma şekli.", en: "How computers get smarter." },
                            answer: "makine öğrenmesi"
                        },
                        {
                            question: { tr: "Deneyimden ders çıkarırım, her yeni bilgiyle daha iyi olurum. Benim adım ne?", en: "I learn from experience, I get better with every new piece of information. What's my name?" },
                            hint: { tr: "Bilgisayarların kendi kendine öğrenmesi.", en: "Computers learning by themselves." },
                            answer: "makine öğrenmesi"
                        }
                    ]
                },
                {
                    title: {
                        tr: "Algoritma",
                        en: "Algorithm"
                    },
                    text: {
                        tr: "Algoritma, bir işi adım adım yapma planıdır.",
                        en: "An algorithm is a step-by-step plan to do a task."
                    },
                    storyTitle: {
                        tr: "Anıl'ın Kek Tarifi", 
                        en: "Anıl's Cake Recipe" 
                    },
                    storyText: {
                        tr: "Anıl kek yapmak istiyordu. Annesi ona tarif verdi: 1. Yumurtayı kır, 2. Şekeri ekle, 3. Karıştır… İşte bu bir algoritmaydı! Adım adım yapınca kek harika oldu.", 
                        en: "Anıl wanted to bake a cake. His mother gave him a recipe: 1. Crack the egg, 2. Add sugar, 3. Mix… This was an algorithm! The cake turned out great when he followed the steps one by one." 
                    },
                    altStoryTitle: {
                        tr: "Robot Temizlikçi",
                        en: "Robot Cleaner"
                    },
                    altStoryText: {
                        tr: "Temizlikçi robot Rumi, evi süpürmek için bir plan izler. Önce salonu, sonra mutfağı, en son da odaları süpürür. Bu plan sayesinde her yer pırıl pırıl olur. Rumi'nin planına ne denir?",
                        en: "Cleaning robot Rumi follows a plan to sweep the house. First the living room, then the kitchen, and finally the bedrooms. Thanks to this plan, everything becomes spotless. What is Rumi's plan called?"
                    },
                    generatedAltStory: { tr: null, en: null }, // To store AI-generated story
                    svg: `
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200" class="w-40 h-40">
                            <rect x="50" y="30" width="100" height="140" rx="15" fill="#38bdf8" opacity="0.2" />
                            <rect x="60" y="40" width="80" height="100" rx="5" fill="#0d1222" />
                            <circle cx="100" cy="155" r="7" fill="#a855f7" />
                            <rect x="70" y="50" width="60" height="5" rx="2" fill="#38bdf8" opacity="0.5" />
                            <rect x="70" y="60" width="60" height="5" rx="2" fill="#38bdf8" opacity="0.5" />
                            <rect x="70" y="70" width="60" height="5" rx="2" fill="#38bdf8" opacity="0.5" />
                            <rect x="70" y="80" width="60" height="5" rx="2" fill="#38bdf8" opacity="0.5" />
                            <rect x="70" y="90" width="60" height="5" rx="2" fill="#38bdf8" opacity="0.5" />
                            <rect x="70" y="100" width="60" height="5" rx="2" fill="#38bdf8" opacity="0.5" />
                            <rect x="70" y="110" width="60" height="5" rx="2" fill="#38bdf8" opacity="0.5" />
                            <circle cx="100" cy="100" r="40" stroke="#a855f7" stroke-width="2" fill="none" opacity="0.3" />
                            <path d="M80 120 L100 135 L120 120" stroke="#a855f7" stroke-width="3" fill="none" opacity="0.3" />
                        </svg>
                    `,
                    riddles: [
                        {
                            question: { tr: "Adım adım yürürüm, Her işin bir sırasını bilirim. Tarifim olmadan iş yapamam!", en: "I walk step by step, I know the order of every task. I can't do anything without my recipe!" },
                            hint: { tr: "“A” harfiyle başlar.", en: "Starts with the letter 'A'." },
                            answer: "algoritma"
                        },
                        {
                            question: { tr: "Bir işi yapmak için sıralı talimatlar veririm. Tıpkı bir yemek tarifi gibiyim. Ben neyim?", en: "I give sequential instructions to do a task. I'm like a cooking recipe. What am I?" },
                            hint: { tr: "Bilgisayarların takip ettiği yol.", en: "The path computers follow." },
                            answer: "algoritma"
                        }
                    ]
                },
                {
                    title: {
                        tr: "Robotlar",
                        en: "Robots"
                    },
                    text: {
                        tr: "Robotlar, bazı işleri bizim yerimize yapabilen makineleridir.",
                        en: "Robots are machines that can do some tasks for us."
                    },
                    storyTitle: {
                        tr: "Ayça'nın Konuşan Diş Fırçası",
                        en: "Ayça's Talking Toothbrush"
                    },
                    storyText: {
                        tr: "Bir sabah Ayça’nın diş fırçası konuştu: “Hazır mısın fırçalamaya?” Bu konuşan robot diş fırçasıydı! Ayça her sabah onunla birlikte dişlerini fırçalayıyordu. Hem eğleniyordu hem de temiz dişleri oluyordu!",
                        en: "One morning, Ayça's toothbrush spoke: 'Are you ready to brush?' It was her talking robot toothbrush! Ayça brushed her teeth with it every morning. She had fun and clean teeth!"
                    },
                    altStoryTitle: {
                        tr: "Uzaylı Yardımcı",
                        en: "Alien Helper"
                    },
                    altStoryText: {
                        tr: "Uzay gemisinde küçük bir robot var. Kaptan uyurken o gemiyi temizliyor, yemek hazırlıyor ve hatta yıldız haritası çıkarıyor. Kaptan uyandığında her şey hazır oluyor. Bu robot, kaptanın en iyi yardımcısı!",
                        en: "There's a small robot on the spaceship. While the captain sleeps, it cleans the ship, prepares food, and even charts the stars. When the captain wakes up, everything is ready. This robot is the captain's best helper!"
                    },
                    generatedAltStory: { tr: null, en: null }, // To store AI-generated story
                    svg: `
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200" class="w-40 h-40">
                            <path d="M50 150 L100 50 L150 150 Z" fill="#38bdf8" opacity="0.2" />
                            <circle cx="100" cy="100" r="30" fill="#a855f7" opacity="0.2" />
                            <path d="M70 120 Q100 100 130 120" stroke="#38bdf8" stroke-width="3" fill="none" />
                            <circle cx="90" cy="90" r="5" fill="#a855f7" />
                            <circle cx="110" cy="90" r="5" fill="#a855f7" />
                            <rect x="95" y="105" width="10" height="20" fill="#a855f7" opacity="0.5" />
                            <path d="M100 50 L100 20" stroke="#a855f7" stroke-width="5" stroke-linecap="round" opacity="0.3" />
                            <path d="M50 150 L30 170" stroke="#a855f7" stroke-width="5" stroke-linecap="round" opacity="0.3" />
                            <path d="M150 150 L170 170" stroke="#a855f7" stroke-width="5" stroke-linecap="round" opacity="0.3" />
                        </svg>
                    `,
                    riddles: [
                        {
                            question: { tr: "İnsan değilim, ama işler yaparım, Bazen konuşur, bazen de süpürürüm.", en: "I am not human, but I do tasks, Sometimes I talk, sometimes I vacuum." },
                            hint: { tr: "“R” harfiyle başlar.", en: "Starts with the letter 'R'." },
                            answer: "robot"
                        },
                        {
                            question: { tr: "Birçok işi yapabilen, demir ve kablolardan oluşan bir makineyim. Ben neyim?", en: "I am a machine made of metal and wires, capable of doing many tasks. What am I?" },
                            hint: { tr: "Bazen fabrikalarda, bazen evlerdeyim.", en: "Sometimes I'm in factories, sometimes in homes." },
                            answer: "robot"
                        }
                    ]
                },
                {
                    title: {
                        tr: "Sesli Asistanlar",
                        en: "Voice Assistants"
                    },
                    text: {
                        tr: "Sesli asistanlar, bize sesimizle yardımcı olan yapay zekalardır.",
                        en: "Voice assistants are artificial intelligences that help us with our voice."
                    },
                    storyTitle: {
                        tr: "Deniz'in Konuşan Kutusu",
                        en: "Deniz's Talking Box"
                    },
                    storyText: {
                        tr: "Deniz, 'Bugün hava nasıl?' diye odasına seslendi. Küçük bir kutu yanıtladı: 'Bugün hava güneşli.' Bu kutu, onun sesli asistanıydı! O artık Deniz’in hava durumunu, şarkısını ve hikayesini bile biliyordu!",
                        en: "Deniz called out to his room, 'How's the weather today?' A small box replied: 'The weather is sunny today.' This box was his voice assistant! It now knew Deniz's weather, songs, and even stories!"
                    },
                    altStoryTitle: {
                        tr: "Akıllı Hoparlör",
                        en: "Smart Speaker"
                    },
                    altStoryText: {
                        tr: "Elif, 'Bana bir masal anlat!' dediğinde, küçük bir hoparlör hemen masal anlatmaya başladı. Elif'in sorularına cevap veriyor, hatta en sevdiği şarkıları bile çalıyordu. Bu akıllı hoparlör, Elif'in en iyi arkadaşı oldu!",
                        en: "When Elif said, 'Tell me a fairy tale!', a small speaker immediately started telling a story. It answered Elif's questions and even played her favorite songs. This smart speaker became Elif's best friend!"
                    },
                    generatedAltStory: { tr: null, en: null }, // To store AI-generated story
                    svg: `
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200" class="w-40 h-40">
                            <circle cx="100" cy="100" r="80" fill="#38bdf8" opacity="0.1" />
                            <circle cx="100" cy="100" r="60" fill="#a855f7" opacity="0.1" />
                            <circle cx="100" cy="100" r="40" fill="#38bdf8" opacity="0.2" />
                            <path d="M100 20 L120 40 L100 60 L80 40 Z" fill="#a855f7" />
                            <path d="M100 180 L120 160 L100 140 L80 160 Z" fill="#a855f7" />
                            <path d="M20 100 L40 120 L60 100 L40 80 Z" fill="#a855f7" />
                            <path d="M180 100 L160 120 L140 100 L160 80 Z" fill="#a855f7" />
                            <line x1="100" y1="60" x2="100" y2="140" stroke="#38bdf8" stroke-width="5" stroke-linecap="round" opacity="0.5" />
                            <line x1="60" y1="100" x2="140" y2="100" stroke="#38bdf8" stroke-width="5" stroke-linecap="round" opacity="0.5" />
                            <circle cx="100" cy="100" r="10" fill="#38bdf8" class="pulse" />
                        </svg>
                    `,
                    riddles: [
                        {
                            question: { tr: "Ben konuşurum, cevap veririm, Bazen şarkı bile söylerim. Sesle çalışırım, adım ne, bilir misin?", en: "I speak, I answer, Sometimes I even sing. I work with sound, do you know my name?" },
                            hint: { tr: "“S” harfiyle başlar.", en: "Starts with the letter 'V'." },
                            answer: "sesli asistan"
                        },
                        {
                            question: { tr: "Bana seslenince hemen cevap veririm. Hava durumunu, şarkıları ve hikayeleri bilirim. Ben neyim?", en: "When you call me, I answer right away. I know the weather, songs, and stories. What am I?" },
                            hint: { tr: "Telefonda veya hoparlörde yaşarım.", en: "I live in a phone or a speaker." },
                            answer: "sesli asistan"
                        }
                    ]
                }
            ];

            // Flatten all riddles for the riddle game, limiting to 5
            const allRiddles = aiConcepts.flatMap((concept, conceptIndex) => 
                concept.riddles.map((riddle, riddleIndex) => ({
                    ...riddle,
                    conceptIndex: conceptIndex,
                    riddleIndex: riddleIndex
                }))
            ).slice(0, 5); // Limit to the first 5 riddles

            // Overall progress calculation
            const totalLearningCards = aiConcepts.length;
            const totalRiddles = allRiddles.length; // Total number of all riddles (now 5)
            const totalMatchingPairs = 4; // Fixed at 4 pairs for the matching game (8 cards)
            const overallTotalProgressItems = totalLearningCards + totalRiddles + totalMatchingPairs; 

            // Function to generate random stars
            function generateStars() {
                for (let i = 0; i < 100; i++) {
                    const star = document.createElement('div');
                    star.className = 'star';
                    star.style.width = `${Math.random() * 3 + 1}px`;
                    star.style.height = star.style.width;
                    star.style.left = `${Math.random() * 100}%`;
                    star.style.top = `${Math.random() * 100}%`;
                    star.style.animationDelay = `${Math.random() * 2}s`;
                    starsContainer.appendChild(star);
                }
            }

            // Function to create confetti
            function createConfetti() {
                const confettiColors = ['#ff7e5f', '#feb47b', '#ffc700', '#a855f7', '#38bdf8', '#ef4444', '#22c55e'];
                for (let i = 0; i < 100; i++) {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.setProperty('--color', confettiColors[Math.floor(Math.random() * confettiColors.length)]);
                    confetti.style.left = `${Math.random() * 100}vw`;
                    confetti.style.top = `${Math.random() * 100}vh`;
                    confetti.style.animationDelay = `${Math.random() * 0.5}s`;
                    confetti.style.animationDuration = `${3 + Math.random() * 2}s`;
                    document.body.appendChild(confetti);
                    // Remove confetti after animation to prevent DOM bloat
                    confetti.addEventListener('animationend', () => confetti.remove());
                }
            }

            // Function to update overall progress bar and percentage
            function updateOverallProgress() {
                const currentProgress = knownCards.size + solvedRiddles.size + matchedPairs.size;
                const progressPercentage = (currentProgress / overallTotalProgressItems) * 100;
                progressBar.style.width = `${progressPercentage}%`;
                progressPercent.textContent = Math.round(progressPercentage);
                overallProgressCountDisplay.textContent = currentProgress;
                overallTotalCountDisplay.textContent = overallTotalProgressItems;

                // Show/hide "Get Certificate" button
                if (knownCards.size === totalLearningCards && solvedRiddles.size === totalRiddles && matchedPairs.size === totalMatchingPairs) {
                    certificateButtonContainer.classList.remove('hidden');
                } else {
                    certificateButtonContainer.classList.add('hidden');
                }
            }

            // Function to update all text content based on current language
            function updateTextContent() {
                document.querySelectorAll('[data-lang-key]').forEach(element => {
                    const key = element.dataset.langKey;
                    if (translations[currentLanguage][key]) {
                        element.textContent = translations[currentLanguage][key];
                    }
                });
                document.querySelectorAll('[data-lang-placeholder-key]').forEach(element => {
                    const key = element.dataset.langPlaceholderKey;
                    if (translations[currentLanguage][key]) {
                        element.placeholder = translations[currentLanguage][key];
                    }
                });
                // Special handling for dynamic content that needs to be re-rendered
                if (currentSection === 'learning') {
                    updateLearningCard();
                } else if (currentSection === 'riddles') {
                    loadRiddle(); // Re-load riddle to get it in the correct language
                } else if (currentSection === 'matching') {
                    initializeMatchingGame(); // Re-initialize matching game for correct language
                }
                // Update user name display if available
                if (userNameDisplay.textContent) {
                    userNameDisplay.textContent = userName;
                }
                if (certificateUserName.textContent) {
                    certificateUserName.textContent = userName;
                }
            }

            // --- Language Toggle Event Listeners ---
            langToggleTr.addEventListener('click', () => {
                currentLanguage = 'tr';
                updateTextContent();
                langToggleTr.classList.add('bg-gray-700');
                langToggleEn.classList.remove('bg-gray-700');
                playClickEffect();
            });

            langToggleEn.addEventListener('click', () => {
                currentLanguage = 'en';
                updateTextContent();
                langToggleEn.classList.add('bg-gray-700');
                langToggleTr.classList.remove('bg-gray-700');
                playClickEffect();
            });

            // --- Learning Card Functions ---
            function updateLearningCard() {
                const card = aiConcepts[currentCardIndex];
                cardFrontTitle.textContent = card.title[currentLanguage];
                cardFrontText.textContent = card.text[currentLanguage];
                cardFrontSvg.innerHTML = card.svg; // Set innerHTML for SVG

                // Set story based on isPrimaryStory flag or generated story
                if (isPrimaryStory) {
                    cardBackTitle.textContent = card.storyTitle[currentLanguage];
                    cardBackText.textContent = card.storyText[currentLanguage];
                    toggleStoryButtonText.textContent = translations[currentLanguage]['toggle_story_button']; // "AI ile Oluştur"
                } else {
                    if (card.generatedAltStory[currentLanguage]) {
                        // If AI story already generated, display it
                        cardBackTitle.textContent = translations[currentLanguage]['toggle_story_button']; // Title for AI generated story
                        cardBackText.textContent = card.generatedAltStory[currentLanguage];
                        toggleStoryButtonText.textContent = translations[currentLanguage]['toggle_story_button']; // Still "AI ile Oluştur"
                    } else {
                        // If not generated, show placeholder and trigger generation on click
                        cardBackTitle.textContent = translations[currentLanguage]['toggle_story_button']; // Title for AI generated story
                        cardBackText.textContent = translations[currentLanguage]['generating_story']; // Show loading message
                        generateAlternativeStory(currentCardIndex); // Trigger generation
                    }
                }

                cardBadge.textContent = `${translations[currentLanguage]['concept']} #${currentCardIndex + 1}`;

                // Reset card flip state
                currentCardElement.classList.remove('flipped');

                // Update button states
                btnPrev.disabled = currentCardIndex === 0;

                // Logic for btnNext:
                if (currentCardIndex === aiConcepts.length - 1) {
                    // On the last card
                    if (knownCards.size === totalLearningCards) {
                        btnNext.disabled = false; // Enable to go to riddles
                        btnNext.textContent = translations[currentLanguage]['proceed_to_riddles']; // New translation key
                    } else {
                        btnNext.disabled = true; // Disable if not all cards are known
                        btnNext.textContent = translations[currentLanguage]['next_button']; // Keep "Next" but disabled
                    }
                } else {
                    btnNext.disabled = false; // Always enabled for intermediate cards
                    btnNext.textContent = translations[currentLanguage]['next_button'];
                }

                // Enable/disable "Anladım" and "Tekrar" based on current card's state
                btnKnown.disabled = knownCards.has(currentCardIndex);
                btnUnknown.disabled = unknownCards.has(currentCardIndex); 

                updateLearningStats();
                updateOverallProgress();
            }

            function updateLearningStats() {
                statsKnown.textContent = knownCards.size;
                statsUnknown.textContent = unknownCards.size;
                statsRemaining.textContent = aiConcepts.length - knownCards.size;
            }

            // --- Text-to-Speech Function ---
            function speakStory() {
                if (synth.speaking) {
                    synth.cancel(); // Stop any ongoing speech
                }
                const textToSpeak = cardBackText.textContent;
                speechUtterance = new SpeechSynthesisUtterance(textToSpeak);
                speechUtterance.lang = currentLanguage === 'tr' ? 'tr-TR' : 'en-US';
                
                speechUtterance.onstart = () => {
                    btnListenStory.disabled = true;
                    btnListenStory.textContent = translations[currentLanguage]['listening_story_button'];
                };
                speechUtterance.onend = () => {
                    btnListenStory.disabled = false;
                    btnListenStory.textContent = translations[currentLanguage]['listen_story_button'];
                };
                speechUtterance.onerror = (event) => {
                    console.error('SpeechSynthesisUtterance.onerror', event);
                    btnListenStory.disabled = false;
                    btnListenStory.textContent = translations[currentLanguage]['listen_story_button'];
                };
                synth.speak(speechUtterance);
                playClickEffect();
            }

            // --- Generate Alternative Story with AI ---
            async function generateAlternativeStory(conceptIndex) {
                const card = aiConcepts[conceptIndex];
                const conceptTitle = card.title[currentLanguage];
                const originalStory = card.storyText[currentLanguage];

                cardBackText.textContent = translations[currentLanguage]['generating_story'];
                btnToggleStory.disabled = true; // Disable button during generation
                playClickEffect();

                try {
                    let chatHistory = [];
                    chatHistory.push({ role: "user", parts: [{ text: `Generate a short, child-friendly alternative story (around 80-120 words) about "${conceptTitle}". Make it different from the original story: "${originalStory}". The story should be in ${currentLanguage === 'tr' ? 'Turkish' : 'English'}.` }] });
                    const payload = { contents: chatHistory };
                    // API Key should be set to the provided key
                    const apiKey = "AIzaSyCEEywiObjmjA1ecwseMortdDKnt5Bwjrc"; 
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
                    
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    const result = await response.json();

                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        const text = result.candidates[0].content.parts[0].text;
                        card.generatedAltStory[currentLanguage] = text; // Store the generated story
                        cardBackText.textContent = text;
                    } else {
                        cardBackText.textContent = translations[currentLanguage]['story_generation_error'];
                        card.generatedAltStory[currentLanguage] = translations[currentLanguage]['story_generation_error']; // Store error
                    }
                } catch (error) {
                    console.error("Gemini API hatası:", error);
                    cardBackText.textContent = translations[currentLanguage]['story_generation_error'];
                    card.generatedAltStory[currentLanguage] = translations[currentLanguage]['story_generation_error']; // Store error
                } finally {
                    btnToggleStory.disabled = false; // Re-enable button
                }
            }


            // --- Ronin AI Chat Function ---
            async function askRonin() { 
                const question = roninQuestionInput.value.trim(); 
                if (!question) {
                    roninAnswer.textContent = translations[currentLanguage]['ronin_no_question']; 
                    return;
                }

                roninAnswer.textContent = translations[currentLanguage]['ronin_thinking']; 
                roninLoadingIndicator.classList.remove('hidden'); 
                askRoninBtn.disabled = true; 
                playClickEffect();

                try {
                    let chatHistory = [];
                    chatHistory.push({ role: "user", parts: [{ text: `A child is asking you a question about AI. Answer in a child-friendly, short, and concise way. The response should be in ${currentLanguage === 'tr' ? 'Turkish' : 'English'}. Question: "${question}"` }] });
                    const payload = { contents: chatHistory };
                    // API Key should be set to the provided key
                    const apiKey = "AIzaSyCEEywiObjmjA1ecwseMortdDKnt5Bwjrc"; 
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
                    
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    const result = await response.json();

                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        const text = result.candidates[0].content.parts[0].text;
                        roninAnswer.textContent = text; 
                    } else {
                        roninAnswer.textContent = translations[currentLanguage]['ronin_api_error']; 
                    }
                } catch (error) {
                    console.error("Gemini API hatası:", error);
                    roninAnswer.textContent = translations[currentLanguage]['ronin_api_error']; 
                } finally {
                    roninLoadingIndicator.classList.add('hidden'); 
                    askRoninBtn.disabled = false; 
                    roninQuestionInput.value = ''; 
                }
            }

            // --- AI Story Generator Function ---
            async function generateAIStory() {
                const keywords = storyKeywordsInput.value.trim();
                if (!keywords) {
                    storyText.textContent = translations[currentLanguage]['story_no_keywords'];
                    return;
                }

                storyText.textContent = translations[currentLanguage]['story_loading'];
                storyLoadingIndicator.classList.remove('hidden');
                generateStoryBtn.disabled = true;
                playClickEffect();

                try {
                    let chatHistory = [];
                    chatHistory.push({ role: "user", parts: [{ text: `Generate a short, child-friendly story (around 100-150 words) about AI, robots, or technology, incorporating the following keywords: "${keywords}". The story should be in ${currentLanguage === 'tr' ? 'Turkish' : 'English'}.` }] });
                    const payload = { contents: chatHistory };
                    // API Key should be set to the provided key
                    const apiKey = "AIzaSyCEEywiObjmjA1ecwseMortdDKnt5Bwjrc"; 
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
                    
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    const result = await response.json();

                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        const text = result.candidates[0].content.parts[0].text;
                        storyText.textContent = text;
                    } else {
                        storyText.textContent = translations[currentLanguage]['story_api_error'];
                    }
                } catch (error) {
                    console.error("Gemini API hatası:", error);
                    storyText.textContent = translations[currentLanguage]['story_api_error'];
                } finally {
                    storyLoadingIndicator.classList.add('hidden');
                    generateStoryBtn.disabled = false;
                    // storyKeywordsInput.value = ''; // Keep keywords for easy re-generation
                }
            }

            // --- "What Does This AI Do?" Scenario Generator Function ---
            async function analyzeAIScenario() {
                const scenario = scenarioInput.value.trim();
                if (!scenario) {
                    scenarioAnalysisText.textContent = translations[currentLanguage]['scenario_no_input'];
                    return;
                }

                scenarioAnalysisText.textContent = translations[currentLanguage]['scenario_loading'];
                scenarioLoadingIndicator.classList.remove('hidden');
                analyzeScenarioBtn.disabled = true;
                playClickEffect();

                try {
                    let chatHistory = [];
                    chatHistory.push({ role: "user", parts: [{ text: `Given the scenario: "${scenario}", describe in 2-3 sentences what AI might do or how it would be used in a child-friendly way. The explanation should be in ${currentLanguage === 'tr' ? 'Turkish' : 'English'}.` }] });
                    const payload = { contents: chatHistory };
                    // API Key should be set to the provided key
                    const apiKey = "AIzaSyCEEywiObjmjA1ecwseMortdDKnt5Bwjrc"; 
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
                    
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    const result = await response.json();

                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        const text = result.candidates[0].content.parts[0].text;
                        scenarioAnalysisText.textContent = text;
                    } else {
                        scenarioAnalysisText.textContent = translations[currentLanguage]['scenario_api_error'];
                    }
                } catch (error) {
                    console.error("Gemini API hatası:", error);
                    scenarioAnalysisText.textContent = translations[currentLanguage]['scenario_api_error'];
                } finally {
                    scenarioLoadingIndicator.classList.add('hidden');
                    analyzeScenarioBtn.disabled = false;
                    // scenarioInput.value = ''; // Keep scenario for easy re-analysis
                }
            }

            // --- AI Fun Fact Generator Function ---
            async function generateAIFunFact() {
                funFactText.textContent = translations[currentLanguage]['fun_fact_loading'];
                funFactLoadingIndicator.classList.remove('hidden');
                generateFunFactBtn.disabled = true;
                playClickEffect();

                try {
                    let chatHistory = [];
                    chatHistory.push({ role: "user", parts: [{ text: `Generate a short, interesting, and child-friendly fun fact about Artificial Intelligence or robots. The fact should be in ${currentLanguage === 'tr' ? 'Turkish' : 'English'}.` }] });
                    const payload = { contents: chatHistory };
                    // API Key should be set to the provided key
                    const apiKey = "AIzaSyCEEywiObjmjA1ecwseMortdDKnt5Bwjrc"; 
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
                    
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    const result = await response.json();

                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        const text = result.candidates[0].content.parts[0].text;
                        funFactText.textContent = text;
                    } else {
                        funFactText.textContent = translations[currentLanguage]['fun_fact_api_error'];
                    }
                } catch (error) {
                    console.error("Gemini API hatası:", error);
                    funFactText.textContent = translations[currentLanguage]['fun_fact_api_error'];
                } finally {
                    funFactLoadingIndicator.classList.add('hidden');
                    generateFunFactBtn.disabled = false;
                }
            }

            // --- AI Invention Idea Generator Function ---
            async function generateAIInventionIdea() {
                const topic = inventionTopicInput.value.trim();
                if (!topic) {
                    inventionText.textContent = translations[currentLanguage]['invention_no_topic'];
                    return;
                }

                inventionText.textContent = translations[currentLanguage]['invention_loading'];
                inventionLoadingIndicator.classList.remove('hidden');
                generateInventionBtn.disabled = true;
                playClickEffect();

                try {
                    let chatHistory = [];
                    chatHistory.push({ role: "user", parts: [{ text: `Generate a creative and child-friendly idea for an AI invention related to "${topic}". Describe it in 2-3 sentences. The idea should be in ${currentLanguage === 'tr' ? 'Turkish' : 'English'}.` }] });
                    const payload = { contents: chatHistory };
                    // API Key should be set to the provided key
                    const apiKey = "AIzaSyCEEywiObjmjA1ecwseMortdDKnt5Bwjrc"; 
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
                    
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    const result = await response.json();

                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        const text = result.candidates[0].content.parts[0].text;
                        inventionText.textContent = text;
                    } else {
                        inventionText.textContent = translations[currentLanguage]['invention_api_error'];
                    }
                } catch (error) {
                    console.error("Gemini API hatası:", error);
                    inventionText.textContent = translations[currentLanguage]['invention_api_error'];
                } finally {
                    inventionLoadingIndicator.classList.add('hidden');
                    generateInventionBtn.disabled = false;
                    // inventionTopicInput.value = ''; // Keep topic for easy re-generation
                }
            }

            // NEW: AI Game Idea Generator Function
            async function generateAIGameIdea() {
                const theme = gameThemeInput.value.trim();
                if (!theme) {
                    gameIdeaText.textContent = translations[currentLanguage]['game_idea_no_theme'];
                    return;
                }

                gameIdeaText.textContent = translations[currentLanguage]['game_idea_loading'];
                gameIdeaLoadingIndicator.classList.remove('hidden');
                generateGameIdeaBtn.disabled = true;
                playClickEffect();

                try {
                    let chatHistory = [];
                    chatHistory.push({ role: "user", parts: [{ text: `Imagine you are an AI that creates fun games for kids. Based on the theme "${theme}", suggest a simple game idea (2-3 sentences) suitable for a 6-year-old. The game should involve AI or robots in some way. Respond in ${currentLanguage === 'tr' ? 'Turkish' : 'English'}.` }] });
                    const payload = { contents: chatHistory };
                    // API Key should be set to the provided key
                    const apiKey = "AIzaSyCEEywiObjmjA1ecwseMortdDKnt5Bwjrc"; 
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
                    
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    const result = await response.json();

                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        const text = result.candidates[0].content.parts[0].text;
                        gameIdeaText.textContent = text;
                    } else {
                        gameIdeaText.textContent = translations[currentLanguage]['game_idea_api_error'];
                    }
                } catch (error) {
                    console.error("Gemini API hatası:", error);
                    gameIdeaText.textContent = translations[currentLanguage]['game_idea_api_error'];
                } finally {
                    gameIdeaLoadingIndicator.classList.add('hidden');
                    generateGameIdeaBtn.disabled = false;
                    // gameThemeInput.value = ''; // Keep theme for easy re-generation
                }
            }


            // --- Riddle Functions ---
            async function showRiddleScreen() {
                gameScreen.classList.add('hidden');
                riddleScreen.classList.remove('hidden');
                currentSection = 'riddles';
                riddleTotalDisplay.textContent = totalRiddles; // Update total riddles display
                await loadRiddle(); // Await the riddle loading
                playClickEffect();
            }

            async function loadRiddle() {
                riddleAnswerInput.value = '';
                riddleFeedback.textContent = '';
                riddleFeedback.className = 'text-center mt-4 font-bold';
                riddleHintText.textContent = ''; // Clear hint text
                btnRiddleHint.disabled = false; // Enable hint button
                riddleLoadingIndicator.classList.add('hidden'); 
                
                const currentRiddle = allRiddles[currentRiddleIndex];
                riddleQuestion.textContent = currentRiddle.question[currentLanguage];

                // Check if the current riddle is already solved
                const riddleId = `${currentRiddle.conceptIndex}_${currentRiddle.riddleIndex}`;
                submitRiddleAnswerBtn.disabled = solvedRiddles.has(riddleId);

                btnPrevRiddle.disabled = currentRiddleIndex === 0;
                
                riddleCountDisplay.textContent = solvedRiddles.size;
                updateOverallProgress();

                if (solvedRiddles.size === totalRiddles) {
                    btnNextRiddle.disabled = false;
                    btnNextRiddle.textContent = translations[currentLanguage]['proceed_to_matching'];
                    btnNextRiddle.removeEventListener('click', nextRiddle);
                    btnNextRiddle.addEventListener('click', () => {
                        showSectionCompleteMessage(translations[currentLanguage]['riddles_complete_message'], showMatchingGameScreen);
                    });
                    createConfetti(); 
                } else {
                    btnNextRiddle.textContent = translations[currentLanguage]['next_button'];
                    btnNextRiddle.removeEventListener('click', showMatchingGameScreen); // Ensure old listener is removed
                    // Only enable next if current riddle is solved and not the last riddle
                    btnNextRiddle.disabled = !solvedRiddles.has(riddleId) || currentRiddleIndex === allRiddles.length - 1; 
                    btnNextRiddle.addEventListener('click', nextRiddle);
                }
            }

            function checkRiddleAnswer() {
                const userAnswer = riddleAnswerInput.value.trim().toLowerCase();
                const currentRiddle = allRiddles[currentRiddleIndex];
                const correctAnswer = currentRiddle.answer.toLowerCase();
                const riddleId = `${currentRiddle.conceptIndex}_${currentRiddle.riddleIndex}`;
                playClickEffect();

                if (userAnswer === correctAnswer) {
                    riddleFeedback.textContent = translations[currentLanguage]['riddle_correct'];
                    riddleFeedback.classList.remove('text-red-400');
                    riddleFeedback.classList.add('text-green-400');
                    solvedRiddles.add(riddleId);
                    submitRiddleAnswerBtn.disabled = true;
                    btnRiddleHint.disabled = true; // Disable hint after solving
                    
                    if (solvedRiddles.size === totalRiddles) {
                        btnNextRiddle.disabled = false;
                        btnNextRiddle.textContent = translations[currentLanguage]['proceed_to_matching'];
                        btnNextRiddle.removeEventListener('click', nextRiddle);
                        btnNextRiddle.addEventListener('click', () => {
                            showSectionCompleteMessage(translations[currentLanguage]['riddles_complete_message'], showMatchingGameScreen);
                        });
                        createConfetti(); 
                    } else {
                        btnNextRiddle.disabled = false; 
                    }
                } else {
                    riddleFeedback.textContent = translations[currentLanguage]['riddle_incorrect'];
                    riddleFeedback.classList.remove('text-green-400');
                    riddleFeedback.classList.add('text-red-400');
                    solvedRiddles.delete(riddleId); 
                    btnNextRiddle.disabled = true; 
                }
                riddleCountDisplay.textContent = solvedRiddles.size;
                updateOverallProgress();
            }

            async function prevRiddle() {
                playClickEffect();
                if (currentRiddleIndex > 0) {
                    currentRiddleIndex--;
                    await loadRiddle();
                }
            }

            async function nextRiddle() {
                playClickEffect();
                if (currentRiddleIndex < allRiddles.length - 1) {
                    currentRiddleIndex++;
                    await loadRiddle();
                }
            }

            // --- Riddle Hint Function ---
            function getRiddleHint() {
                playClickEffect();
                const currentRiddle = allRiddles[currentRiddleIndex];
                riddleHintText.textContent = currentRiddle.hint[currentLanguage];
                btnRiddleHint.disabled = true; // Disable hint after showing
            }

            // --- Matching Game Functions ---
            function showMatchingGameScreen() {
                gameScreen.classList.add('hidden');
                riddleScreen.classList.add('hidden');
                matchingGameScreen.classList.remove('hidden');
                currentSection = 'matching';
                initializeMatchingGame();
                updateOverallProgress();
                playClickEffect();
            }

            function initializeMatchingGame() {
                matchingGrid.innerHTML = ''; 
                flippedCards = [];
                lockBoard = false;
                matchedPairs.clear(); 

                // Select 4 random concepts for the matching game (for 8 cards)
                const shuffledConcepts = [...aiConcepts].sort(() => 0.5 - Math.random());
                const selectedConcepts = shuffledConcepts.slice(0, 4); // Select 4 concepts

                const cardsToMatch = [];
                selectedConcepts.forEach((concept, index) => {
                    // Use the concept title
                    cardsToMatch.push({ id: concept.title[currentLanguage], text: concept.title[currentLanguage], type: 'concept' });
                    // Use the first riddle from the concept
                    cardsToMatch.push({ id: concept.title[currentLanguage], text: concept.riddles[0].question[currentLanguage], type: 'riddle' });
                });

                // Shuffle cards
                cardsToMatch.sort(() => Math.random() - 0.5);

                cardsToMatch.forEach((cardData, index) => {
                    const cardElement = document.createElement('div');
                    cardElement.classList.add('matching-card');
                    cardElement.dataset.id = cardData.id; // Concept title as ID
                    cardElement.dataset.type = cardData.type; // 'concept' or 'riddle'
                    cardElement.dataset.index = index; 

                    cardElement.innerHTML = `
                        <div class="card-face card-front-face">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-cyan-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
                                <path d="M2 17l10 5 10-5"></path>
                                <path d="M2 12l10 5 10-5"></path>
                            </svg>
                        </div>
                        <div class="card-face card-back-face">
                            ${cardData.text}
                        </div>
                    `;
                    cardElement.addEventListener('click', flipCard);
                    matchingGrid.appendChild(cardElement);
                });

                matchingFeedback.textContent = '';
                btnCompleteMatching.classList.add('hidden');
                playClickEffect();
            }

            function flipCard() {
                playClickEffect();
                if (lockBoard) return;
                if (this === flippedCards[0]) return; 

                this.classList.add('flipped'); // Apply flipped class directly to the matching-card
                flippedCards.push(this);

                if (flippedCards.length === 2) {
                    lockBoard = true;
                    checkForMatch();
                }
            }

            function checkForMatch() {
                const [firstCard, secondCard] = flippedCards;
                // A match occurs if IDs are the same AND types are different (concept vs riddle)
                const isMatch = firstCard.dataset.id === secondCard.dataset.id && firstCard.dataset.type !== secondCard.dataset.type;

                if (isMatch) {
                    disableCards();
                    matchedPairs.add(firstCard.dataset.id); // Add the concept title as the matched ID
                    matchingFeedback.textContent = translations[currentLanguage]['matching_matched'];
                    matchingFeedback.classList.remove('text-red-400');
                    matchingFeedback.classList.add('text-green-400');
                } else {
                    unflipCards();
                    matchingFeedback.textContent = translations[currentLanguage]['matching_not_matched'];
                    matchingFeedback.classList.remove('text-green-400');
                    matchingFeedback.classList.add('text-red-400');
                }
                updateOverallProgress();
                if (matchedPairs.size === totalMatchingPairs) {
                    matchingFeedback.textContent = translations[currentLanguage]['matching_all_matched'];
                    matchingFeedback.classList.remove('text-red-400');
                    matchingFeedback.classList.add('text-green-400');
                    btnCompleteMatching.classList.remove('hidden');
                    createConfetti(); 
                    showSectionCompleteMessage(translations[currentLanguage]['matching_complete_message'], showCertificateScreen);
                }
            }

            function disableCards() {
                flippedCards.forEach(card => {
                    card.removeEventListener('click', flipCard);
                    card.classList.add('matched');
                });
                resetBoard();
            }

            function unflipCards() {
                setTimeout(() => {
                    flippedCards.forEach(card => {
                        card.classList.remove('flipped');
                    });
                    resetBoard();
                }, 1000);
            }

            function resetBoard() {
                [flippedCards, lockBoard] = [[], false];
            }

            // --- Screen Transition Functions ---
            async function showCertificateScreen() {
                gameScreen.classList.add('hidden');
                riddleScreen.classList.add('hidden');
                matchingGameScreen.classList.add('hidden');
                certificateScreen.classList.remove('hidden');
                certificateUserName.textContent = userName;
                certificateDate.textContent = new Date().toLocaleDateString(currentLanguage === 'tr' ? 'tr-TR' : 'en-US');
                playClickEffect();
                createConfetti(); // Trigger confetti when certificate is generated

                // Generate personalized certificate message
                certificateMessage.textContent = translations[currentLanguage]['certificate_message_loading'];
                try {
                    let chatHistory = [];
                    chatHistory.push({ role: "user", parts: [{ text: `A child named ${userName} completed the AI adventure. Write a 2-3 sentence, motivating, AI-themed congratulatory message for them. The message should be in ${currentLanguage === 'tr' ? 'Turkish' : 'English'}.` }] });
                    const payload = { contents: chatHistory };
                    // API Key should be set to the provided key
                    const apiKey = "AIzaSyCEEywiObjmjA1ecwseMortdDKnt5Bwjrc"; 
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
                    
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    const result = await response.json();

                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        const text = result.candidates[0].content.parts[0].text;
                        certificateMessage.textContent = text;
                    } else {
                        certificateMessage.textContent = translations[currentLanguage]['certificate_message_default'];
                    }
                } catch (error) {
                    console.error("Gemini API hatası:", error);
                    certificateMessage.textContent = translations[currentLanguage]['certificate_message_default'];
                }
            }

            function backToGameFromCertificate() {
                playClickEffect();
                certificateScreen.classList.add('hidden');
                // Determine which screen to go back to based on progress
                if (matchedPairs.size < totalMatchingPairs) {
                    matchingGameScreen.classList.remove('hidden');
                    currentSection = 'matching';
                } else if (solvedRiddles.size < totalRiddles) {
                    riddleScreen.classList.remove('hidden');
                    currentSection = 'riddles';
                } else {
                    gameScreen.classList.remove('hidden');
                    currentSection = 'learning';
                }
                updateTextContent(); // Ensure text is updated on return
            }

            // --- Custom Confirmation Modal Function ---
            function showCustomConfirm(message, callback) {
                modalMessage.textContent = message;
                modalConfirmBtn.textContent = translations[currentLanguage]['modal_confirm_title']; // Reset button text
                modalCancelBtn.classList.remove('hidden'); // Ensure cancel button is visible

                customConfirmModal.classList.remove('hidden');

                const handleConfirm = () => {
                    playClickEffect();
                    customConfirmModal.classList.add('hidden');
                    callback(true);
                    modalConfirmBtn.removeEventListener('click', handleConfirm);
                    modalCancelBtn.removeEventListener('click', handleCancel);
                };

                const handleCancel = () => {
                    playClickEffect();
                    customConfirmModal.classList.add('hidden');
                    callback(false);
                    modalConfirmBtn.removeEventListener('click', handleConfirm);
                    modalCancelBtn.removeEventListener('click', handleCancel);
                };

                modalConfirmBtn.addEventListener('click', handleConfirm);
                modalCancelBtn.addEventListener('click', handleCancel);
            }

            function showSectionCompleteMessage(message, nextScreenFunction) {
                modalMessage.textContent = message;
                modalConfirmBtn.textContent = translations[currentLanguage]['continue_button'];
                modalCancelBtn.classList.add('hidden'); // Hide cancel button for completion message
                customConfirmModal.classList.remove('hidden');

                const handleConfirm = () => {
                    playClickEffect();
                    customConfirmModal.classList.add('hidden');
                    modalCancelBtn.classList.remove('hidden'); // Show cancel button again
                    modalConfirmBtn.removeEventListener('click', handleConfirm);
                    nextScreenFunction(); // Proceed to the next screen
                };

                modalConfirmBtn.addEventListener('click', handleConfirm);
            }

            // --- Click Effect Function (Sound and Vibration) ---
            function playClickEffect() {
                // Play sound
                clickSound.currentTime = 0; // Rewind to start
                clickSound.play().catch(e => console.log("Audio play prevented:", e)); // Catch promise rejection

                // Vibrate (if supported)
                if (navigator.vibrate) {
                    navigator.vibrate(50); // Vibrate for 50ms
                }
            }

            // --- Event Listeners ---

            // Initial Intro Flow
            continueIntroBtn.addEventListener('click', () => {
                playClickEffect();
                initialIntroScreen.classList.add('hidden');
                nameInputSection.classList.remove('hidden');
                // Initialize 3D robot animation when name input section is shown
                initRobotAnimation();
            });

            startAdventureBtn.addEventListener('click', () => {
                playClickEffect();
                userName = userNameInput.value.trim();
                if (userName) {
                    welcomeScreen.classList.add('hidden');
                    gameScreen.classList.remove('hidden');
                    userNameDisplay.textContent = userName;
                    currentSection = 'learning';
                    updateLearningCard();
                    updateTextContent(); // Update text for game screen
                } else {
                    // Using a custom message instead of alert for better UX
                    showCustomConfirm(translations[currentLanguage]['ronin_no_question'], () => {}); // Just show message, no action
                }
            });

            currentCardElement.addEventListener('click', () => {
                playClickEffect();
                currentCardElement.classList.toggle('flipped');
            });

            btnListenStory.addEventListener('click', speakStory); 
            btnToggleStory.addEventListener('click', () => {
                playClickEffect();
                isPrimaryStory = !isPrimaryStory; // Toggle the flag
                updateLearningCard(); // Re-render the card with the new story (potentially triggering AI generation)
            });

            btnPrev.addEventListener('click', () => {
                playClickEffect();
                if (currentCardIndex > 0) {
                    currentCardIndex--;
                    isPrimaryStory = true; // Reset to primary story when navigating
                    updateLearningCard();
                }
            });

            btnNext.addEventListener('click', () => {
                playClickEffect();
                if (currentCardIndex < aiConcepts.length - 1) {
                    currentCardIndex++;
                    isPrimaryStory = true; // Reset to primary story when navigating
                    updateLearningCard();
                } else if (knownCards.size === totalLearningCards) {
                    showSectionCompleteMessage(translations[currentLanguage]['learning_complete_message'], showRiddleScreen);
                } else {
                    // Optional: Provide feedback that all cards must be understood
                    // For now, just keep it disabled, as per current behavior
                    console.log("Please mark all cards as 'understood' to proceed to riddles.");
                }
            });

            btnKnown.addEventListener('click', () => {
                playClickEffect();
                if (!knownCards.has(currentCardIndex)) {
                    knownCards.add(currentCardIndex);
                    unknownCards.delete(currentCardIndex); 
                    updateLearningCard(); 
                }
            });

            btnUnknown.addEventListener('click', () => {
                playClickEffect();
                if (!unknownCards.has(currentCardIndex)) {
                    unknownCards.add(currentCardIndex);
                    knownCards.delete(currentCardIndex); 
                    updateLearningCard(); 
                }
            });

            btnReset.addEventListener('click', () => {
                playClickEffect();
                showCustomConfirm(translations[currentLanguage]['modal_reset_message'], (result) => {
                    if (result) {
                        knownCards.clear();
                        unknownCards.clear();
                        solvedRiddles.clear();
                        matchedPairs.clear();
                        currentCardIndex = 0;
                        currentRiddleIndex = 0;
                        currentSection = 'intro'; // Go back to intro screen on full reset
                        // Also reset generated alternative stories
                        aiConcepts.forEach(concept => {
                            concept.generatedAltStory = { tr: null, en: null };
                        });
                        welcomeScreen.classList.remove('hidden');
                        initialIntroScreen.classList.remove('hidden'); // Show initial intro
                        nameInputSection.classList.add('hidden'); // Hide name input
                        gameScreen.classList.add('hidden');
                        riddleScreen.classList.add('hidden');
                        matchingGameScreen.classList.add('hidden');
                        certificateScreen.classList.add('hidden');
                        updateLearningCard(); // This will reset card display
                        updateOverallProgress(); // This will reset progress display
                        updateTextContent(); // Ensure text is updated after reset
                        // Re-add riddle next button listener for the default behavior
                        btnNextRiddle.removeEventListener('click', showMatchingGameScreen);
                        btnNextRiddle.addEventListener('click', nextRiddle);
                    }
                });
            });

            // Main Menu Buttons
            btnMainMenuGame.addEventListener('click', () => {
                playClickEffect();
                showCustomConfirm(translations[currentLanguage]['modal_reset_message'], (result) => {
                    if (result) {
                        knownCards.clear();
                        unknownCards.clear();
                        solvedRiddles.clear();
                        matchedPairs.clear();
                        currentCardIndex = 0;
                        currentRiddleIndex = 0;
                        currentSection = 'intro'; // Go back to intro screen on full reset
                        // Also reset generated alternative stories
                        aiConcepts.forEach(concept => {
                            concept.generatedAltStory = { tr: null, en: null };
                        });
                        welcomeScreen.classList.remove('hidden');
                        initialIntroScreen.classList.remove('hidden'); // Show initial intro
                        nameInputSection.classList.add('hidden'); // Hide name input
                        gameScreen.classList.add('hidden');
                        riddleScreen.classList.add('hidden');
                        matchingGameScreen.classList.add('hidden');
                        certificateScreen.classList.add('hidden');
                        updateLearningCard(); // This will reset card display
                        updateOverallProgress(); // This will reset progress display
                        updateTextContent(); // Ensure text is updated after reset
                        // Re-add riddle next button listener for the default behavior
                        btnNextRiddle.removeEventListener('click', showMatchingGameScreen);
                        btnNextRiddle.addEventListener('click', nextRiddle);
                    }
                });
            });
            btnMainMenuRiddle.addEventListener('click', () => {
                playClickEffect();
                showCustomConfirm(translations[currentLanguage]['modal_reset_message'], (result) => {
                    if (result) {
                        knownCards.clear();
                        unknownCards.clear();
                        solvedRiddles.clear();
                        matchedPairs.clear();
                        currentCardIndex = 0;
                        currentRiddleIndex = 0;
                        currentSection = 'intro'; // Go back to intro screen on full reset
                        // Also reset generated alternative stories
                        aiConcepts.forEach(concept => {
                            concept.generatedAltStory = { tr: null, en: null };
                        });
                        welcomeScreen.classList.remove('hidden');
                        initialIntroScreen.classList.remove('hidden'); // Show initial intro
                        nameInputSection.classList.add('hidden'); // Hide name input
                        gameScreen.classList.add('hidden');
                        riddleScreen.classList.add('hidden');
                        matchingGameScreen.classList.add('hidden');
                        certificateScreen.classList.add('hidden');
                        updateLearningCard(); // This will reset card display
                        updateOverallProgress(); // This will reset progress display
                        updateTextContent(); // Ensure text is updated after reset
                        // Re-add riddle next button listener for the default behavior
                        btnNextRiddle.removeEventListener('click', showMatchingGameScreen);
                        btnNextRiddle.addEventListener('click', nextRiddle);
                    }
                });
            });
            btnMainMenuMatching.addEventListener('click', () => {
                playClickEffect();
                showCustomConfirm(translations[currentLanguage]['modal_reset_message'], (result) => {
                    if (result) {
                        knownCards.clear();
                        unknownCards.clear();
                        solvedRiddles.clear();
                        matchedPairs.clear();
                        currentCardIndex = 0;
                        currentRiddleIndex = 0;
                        currentSection = 'intro'; // Go back to intro screen on full reset
                        // Also reset generated alternative stories
                        aiConcepts.forEach(concept => {
                            concept.generatedAltStory = { tr: null, en: null };
                        });
                        welcomeScreen.classList.remove('hidden');
                        initialIntroScreen.classList.remove('hidden'); // Show initial intro
                        nameInputSection.classList.add('hidden'); // Hide name input
                        gameScreen.classList.add('hidden');
                        riddleScreen.classList.add('hidden');
                        matchingGameScreen.classList.add('hidden');
                        certificateScreen.classList.add('hidden');
                        updateLearningCard(); // This will reset card display
                        updateOverallProgress(); // This will reset progress display
                        updateTextContent(); // Ensure text is updated after reset
                        // Re-add riddle next button listener for the default behavior
                        btnNextRiddle.removeEventListener('click', showMatchingGameScreen);
                        btnNextRiddle.addEventListener('click', nextRiddle);
                    }
                });
            });

            // Ronin Chat Event Listeners
            askRoninBtn.addEventListener('click', askRonin);
            roninQuestionInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    askRonin();
                }
            });

            // AI Story Generator Event Listeners
            generateStoryBtn.addEventListener('click', generateAIStory);
            storyKeywordsInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    generateAIStory();
                }
            });

            // "What Does This AI Do?" Scenario Generator Event Listeners
            analyzeScenarioBtn.addEventListener('click', analyzeAIScenario);
            scenarioInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    analyzeAIScenario();
                }
            });

            // AI Fun Fact Generator Event Listener
            generateFunFactBtn.addEventListener('click', generateAIFunFact);

            // AI Invention Idea Generator Event Listener
            generateInventionBtn.addEventListener('click', generateAIInventionIdea);
            inventionTopicInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    generateAIInventionIdea();
                }
            });

            // NEW: AI Game Idea Generator Event Listener
            generateGameIdeaBtn.addEventListener('click', generateAIGameIdea);
            gameThemeInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    generateAIGameIdea();
                }
            });

            // Riddle Screen Event Listeners
            submitRiddleAnswerBtn.addEventListener('click', checkRiddleAnswer);
            riddleAnswerInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    checkRiddleAnswer();
                }
            });
            btnPrevRiddle.addEventListener('click', prevRiddle);
            btnNextRiddle.addEventListener('click', nextRiddle); 
            btnRiddleHint.addEventListener('click', getRiddleHint); // New hint button listener

            // Matching Game Event Listeners
            btnResetMatching.addEventListener('click', initializeMatchingGame);
            btnCompleteMatching.addEventListener('click', () => { showSectionCompleteMessage(translations[currentLanguage]['matching_complete_message'], showCertificateScreen); });

            // Certificate screen button event listeners
            if (btnBackToGame) {
                btnBackToGame.addEventListener('click', backToGameFromCertificate);
            } else {
                console.error('Error: btn-back-to-game element not found!');
            }
            if (btnPrintCertificate) {
                btnPrintCertificate.addEventListener('click', () => {
                    playClickEffect();
                    window.print();
                });
            } else {
                console.error('Error: btn-print-certificate element not found!');
            }

            // New "Get Certificate" button listener
            btnGetCertificate.addEventListener('click', showCertificateScreen);


            // Initial setup
            generateStars();
            updateOverallProgress(); 
            updateTextContent(); // Call initially to set default language texts
            langToggleTr.classList.add('bg-gray-700'); // Highlight default language button
            initialIntroScreen.classList.remove('hidden'); // Ensure initial intro is visible
            nameInputSection.classList.add('hidden'); // Ensure name input is hidden initially
        });
    </script>
</body>
</html>
